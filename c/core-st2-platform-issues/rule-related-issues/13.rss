<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:discourse="http://www.discourse.org/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Rules - StackStorm Support (ARCHIVED)</title>
    <link>https://forum.stackstorm.com/c/core-st2-platform-issues/rule-related-issues/13</link>
    <description>Topics in the &#39;Rules&#39; category </description>
    
      <lastBuildDate>Thu, 19 Aug 2021 08:35:37 +0000</lastBuildDate>
      <atom:link href="https://forum.stackstorm.com/c/core-st2-platform-issues/rule-related-issues/13.rss" rel="self" type="application/rss+xml" />
        <item>
          <title>Is there one rule and sensor that applies to all actions?</title>
          <dc:creator><![CDATA[Bryan]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hello,</p>
<p>I’m searching for a general way to write rules and sensors.</p>
<p>For example, I have 2 timing action: <strong>action_a, action_b</strong>:</p>
<pre><code class="lang-auto">**action_a brief definition:**
parameters:
  param_a_1:
    type: object
    required: true
  param_a_2:
    type: object
    required: true
</code></pre>
<pre><code class="lang-auto">**action_b brief definition:**
parameters:
  param_b_1:
    type: string
    required: true
  param_b_2:
    type: array
    required: true
  param_b_3:
    type: string
    required: true
</code></pre>
<p>I save the action and its param as key-value pair(change to yaml for human read) in stackstorm mongodb:</p>
<pre><code class="lang-auto">deploy_time: "2021-08-19 23:00" 
action: pack1.action_a
params:
  param_a_1:
    key_1: value_1
  param_a_2:
    key_a_2: value_a_2
</code></pre>
<pre><code class="lang-auto">deploy_time: "2021-08-19 23:00"
action: pack2.action_b
params:
  param_b_1: "string_1"
  param_b_2:
    - object_1
    - object_2
  param_b_3: "string_3"
</code></pre>
<p>Then I write a sensor to read stackstorm Datastore.  Sensor will compare current system time and <code>deploy_time</code>, if current system time is later than <code>deploy_time</code>, sensor will generate a playload to rule.</p>
<p>As you can image, I have to write 3 very similar file( <code>sensor.py</code>; <code>sensor.yaml</code>; <code>rule.yaml</code> ) for each action. The only difference between them is <code>payload_schema</code> section of <code>sensor.yaml</code><br>
and <code>action</code> section of <code>rule.yaml</code>.<br>
<code>sensor.py</code> is almost exactly the same.</p>
<p>Is there a general way to write rules and sensors?</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/is-there-one-rule-and-sensor-that-applies-to-all-actions/1814">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/is-there-one-rule-and-sensor-that-applies-to-all-actions/1814</link>
          <pubDate>Thu, 19 Aug 2021 08:35:37 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1814</guid>
          <source url="https://forum.stackstorm.com/t/is-there-one-rule-and-sensor-that-applies-to-all-actions/1814.rss">Is there one rule and sensor that applies to all actions?</source>
        </item>
        <item>
          <title>Config_context in rules</title>
          <dc:creator><![CDATA[sekhars]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>I was wondering if we can use <code>config_context</code> in Rules for a given pack. I have been unsuccessful so far</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/config-context-in-rules/1805">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/config-context-in-rules/1805</link>
          <pubDate>Sun, 08 Aug 2021 22:31:50 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1805</guid>
          <source url="https://forum.stackstorm.com/t/config-context-in-rules/1805.rss">Config_context in rules</source>
        </item>
        <item>
          <title>How to compare datetime in Rule</title>
          <dc:creator><![CDATA[Bryan]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hello,<br>
I want to compare trigger’s datetime with current time in rules.<br>
For expample, some action will only execute on work time, which means trigger time should between 9:00 and 18:00, Monday - Friday.<br>
I can’t find any jinja example <code>timediff_lt</code> or <code>timediff_gt</code> in example pack.<br>
Any suggestions?</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/how-to-compare-datetime-in-rule/1778">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/how-to-compare-datetime-in-rule/1778</link>
          <pubDate>Tue, 13 Jul 2021 12:39:08 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1778</guid>
          <source url="https://forum.stackstorm.com/t/how-to-compare-datetime-in-rule/1778.rss">How to compare datetime in Rule</source>
        </item>
        <item>
          <title>Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions</title>
          <dc:creator><![CDATA[Bryan]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hello,<br>
Did anyone try to deploy Stackstorm HA on Virtual Linux directly? I try to search in this forum, but it look like few people have the same problem as me.<br>
Anyway, I have Stackstorm HA deploy on 3 Oracle Linux 8. But I’m facing many Duplicated <code>Actions</code> issue:</p>
<ul>
<li>First, I’m facing duplicated st2timersengine.</li>
</ul>
<p>According to <a href="https://docs.stackstorm.com/reference/ha.html" class="inline-onebox" rel="noopener nofollow ugc">High Availability Deployment — StackStorm 3.5.0 documentation</a>,</p>
<pre><code class="lang-auto">[timer]
enable = False
</code></pre>
<p>I set 2 false and 1 true on 3 vms, but it don’t work for me, very strange.<br>
Anyway I solve this issue by using keeplived, As mentioned as <code>external monitoring</code></p>
<ul>
<li>Now, I find that multiple PollingSensor also cause duplicated actions</li>
</ul>
<p>There are 3 same rule/sensor of cause(each Stackstorm has one st2rulesengine/st2sensorcontainer), because they load the same pack.</p>
<p>Obviously, 3 sensor polling the same system, get 3 same result and generate 3 same payloads, and then trigger 3 same actions.</p>
<p>But I can’t kill 2 of them like st2timersengine, becasue external webhook send requset to upper Nginx, and nginx transfer the request to one of 3 stackstorm. They will cause webhook out of work.</p>
<p>What should I do?<br>
Otherwise, I have to use timer action instead of PollingSensor.</p>
            <p><small>4 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/stackstorm-ha-multiple-pollingsensor-cause-duplicated-actions/1773">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/stackstorm-ha-multiple-pollingsensor-cause-duplicated-actions/1773</link>
          <pubDate>Mon, 12 Jul 2021 10:56:01 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1773</guid>
          <source url="https://forum.stackstorm.com/t/stackstorm-ha-multiple-pollingsensor-cause-duplicated-actions/1773.rss">Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions</source>
        </item>
        <item>
          <title>Rule not working with error {rule.trigger &quot;core.st2.webhook&quot; and trigger.ref &quot;core.59362943-d192-4502-bc0a-9c7c8ecc69d1&quot; do not match.}</title>
          <dc:creator><![CDATA[prabhanshu]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hi Team,</p>
<p>I created a rule:</p>
<pre><code class="lang-auto">---
    name: "pdalert_remediation_rule"
    pack: "default"
    description: "PD alert remediation rule"
    enabled: true

    trigger:
        type: "core.st2.webhook"
        parameters:
            url: "sample"

    criteria:
        trigger.body.messages[0].event:
            pattern: "incident.trigger"
            type: "equals"

    action:
        ref: "default.pdalert_remediation"
        parameters:
            hostname: "{{trigger.body.messages[0].log_entries[0].channel.host}}.srvs.ahdev.co"
            event_id: "{{trigger.body.messages[0].log_entries[0].agent.id}}"
            email_id: "prabhanshu.pandey@acquia.com"
</code></pre>
<p>While executing the rule trigger is getting processed but no execution ID is getting created.</p>
<p>While looking into it further and testing the rule i see.</p>
<pre><code class="lang-auto">[05:28:36] root@ded-95.opsteam1:/opt/stackstorm/packs/default/rules# st2-rule-tester --trigger-instance-id=60e6467244c92e3371291b06 --rule=pdalert_remediation_rule.yaml --debug
2021-07-08 05:28:44,218 INFO [-] Connecting to database "st2" @ "127.0.0.1:27017" as user "stackstorm".
2021-07-08 05:28:44,279 INFO [-] Successfully connected to database "st2" @ "127.0.0.1:27017" as user "stackstorm".
2021-07-08 05:28:44,279 DEBUG [-] Ensuring database indexes...
2021-07-08 05:28:45,333 DEBUG [-] Skipping index cleanup for blacklisted model "PermissionGrantDB"...
2021-07-08 05:28:45,721 DEBUG [-] Indexes are ensured for models: ActionAliasDB, ActionAliasDB, ActionDB, ActionExecutionDB, ActionExecutionDB, ActionExecutionOutputDB, ActionExecutionSchedulingQueueItemDB, ActionExecutionStateDB, ActionExecutionStateDB, ApiKeyDB, ConfigDB, ConfigSchemaDB, GroupToRoleMappingDB, KeyValuePairDB, LiveActionDB, LiveActionDB, PackDB, PermissionGrantDB, PolicyDB, PolicyTypeDB, RoleDB, RuleDB, RuleEnforcementDB, RunnerTypeDB, RunnerTypeDB, SensorTypeDB, TaskExecutionDB, TokenDB, TraceDB, TriggerDB, TriggerInstanceDB, TriggerTypeDB, UserDB, UserRoleAssignmentDB, WorkflowExecutionDB
2021-07-08 05:28:45,804 INFO [-] rule.trigger "core.st2.webhook" and trigger.ref "core.59362943-d192-4502-bc0a-9c7c8ecc69d1" do not match.
2021-07-08 05:28:45,821 INFO [-] === RULE DOES NOT MATCH ===
</code></pre>
<p>Can someone look into it? I so want to move forward from the below error.</p>
<pre><code class="lang-auto">2021-07-08 05:28:45,804 INFO [-] rule.trigger "core.st2.webhook" and trigger.ref "core.59362943-d192-4502-bc0a-9c7c8ecc69d1" do not match.
</code></pre>
<p>Regards,<br>
Prabhanshu.</p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/rule-not-working-with-error-rule-trigger-core-st2-webhook-and-trigger-ref-core-59362943-d192-4502-bc0a-9c7c8ecc69d1-do-not-match/1771">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/rule-not-working-with-error-rule-trigger-core-st2-webhook-and-trigger-ref-core-59362943-d192-4502-bc0a-9c7c8ecc69d1-do-not-match/1771</link>
          <pubDate>Thu, 08 Jul 2021 05:38:32 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1771</guid>
          <source url="https://forum.stackstorm.com/t/rule-not-working-with-error-rule-trigger-core-st2-webhook-and-trigger-ref-core-59362943-d192-4502-bc0a-9c7c8ecc69d1-do-not-match/1771.rss">Rule not working with error {rule.trigger &quot;core.st2.webhook&quot; and trigger.ref &quot;core.59362943-d192-4502-bc0a-9c7c8ecc69d1&quot; do not match.}</source>
        </item>
        <item>
          <title>How to specify hosts target of an action in rule</title>
          <dc:creator><![CDATA[nxstorm]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hi,</p>
<p>New to stackstorm. I have been following example to get myself up to speed. There is one thing that i am not too sure about. I have an action which is remote-shell-script type and able to run individually cmd against remote host using ‘st2 run action hosts=ABC’.  However, when i tried the same action with a rule, it seems falling apart, and the rule wont get executed according to the rule-enforcement list. I realized that I did not specify the target host to run against. So I am wondering to where in rule definition i could specify the hosts=ABC ???</p>
<p>Thanks,<br>
Storm</p>
            <p><small>5 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/how-to-specify-hosts-target-of-an-action-in-rule/1697">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/how-to-specify-hosts-target-of-an-action-in-rule/1697</link>
          <pubDate>Thu, 13 May 2021 20:41:59 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1697</guid>
          <source url="https://forum.stackstorm.com/t/how-to-specify-hosts-target-of-an-action-in-rule/1697.rss">How to specify hosts target of an action in rule</source>
        </item>
        <item>
          <title>Rule not found in stackstorm</title>
          <dc:creator><![CDATA[deebika]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>when I create rule its throwing error.<br>
rule is not found.what would be the problem for this.</p>
            <p><small>6 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/rule-not-found-in-stackstorm/1645">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/rule-not-found-in-stackstorm/1645</link>
          <pubDate>Fri, 09 Apr 2021 08:12:45 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1645</guid>
          <source url="https://forum.stackstorm.com/t/rule-not-found-in-stackstorm/1645.rss">Rule not found in stackstorm</source>
        </item>
        <item>
          <title>SensorImplementation</title>
          <dc:creator><![CDATA[pawan.m]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>I have created a Sensor and implemented its methods (<strong>init</strong>,setup,add_trigger,update_trigger etc).</p>
<p>I am taking parameters while creating the trigger.</p>
<pre><code>---
  class_name: "PUBSUBSync"
  entry_point: "PUBSUBSync.py"
  description: "PUBSUB Synchronous Testing"
  trigger_types:
    -
      name: "pubsub"
      description: "GCP PUBSUB"
      parameters_schema:
        type: "object"
        properties:
          subscriber_id:
            type: "string"
            required: true
      payload_schema:
        type: "object"
        properties:
          message:
            type: "object"
          topic:
            type: "string"
</code></pre>
<p>When running the stackstorm i am getting this following error in rulesengine log</p>
<p>2021-03-09 12:07:30,539 139958497248912 DEBUG utils [-] No trigger in db for optigotest.event<br>
2021-03-09 12:07:30,540 139958497248912 ERROR consumers [-] StagedQueueConsumer failed to process message: {‘trace_context’: None, ‘trigger’: ‘optigotest.event’, ‘payload’: {‘topic’: ‘sttest’, ‘message’: {‘key2’: ‘value2’, ‘key1’: ‘value1’}}}<br>
Traceback (most recent call last):<br>
File “/opt/stackstorm/st2/lib/python2.7/site-packages/st2common/transport/consumers.py”, line 86, in process<br>
response = self._handler.pre_ack_process(body)<br>
File “/opt/stackstorm/st2/lib/python2.7/site-packages/st2reactor/rules/worker.py”, line 57, in pre_ack_process<br>
raise_on_no_trigger=True)<br>
File “/opt/stackstorm/st2/lib/python2.7/site-packages/st2reactor/container/utils.py”, line 45, in create_trigger_instance<br>
raise StackStormDBObjectNotFoundError(‘Trigger not found for %s’ % trigger)<br>
StackStormDBObjectNotFoundError: Trigger not found for optigotest.event<br>
2021-03-09 12:07:34,078 139958497248912 DEBUG triggers [-] Looking up TriggerDB by id: 603b249329b1a881c6b43dcf<br>
2021-03-09 12:07:34,124 139958498188816 DEBUG rules [-] Querying rules with trigger core.899b1edc-3454-480a-bac6-b9fdeea0dd4c</p>
<p>Is there any error in the way i implemented a Sensor ?</p>
<p>Thanks in Advance !!</p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/sensorimplementation/1592">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/sensorimplementation/1592</link>
          <pubDate>Wed, 10 Mar 2021 05:02:03 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1592</guid>
          <source url="https://forum.stackstorm.com/t/sensorimplementation/1592.rss">SensorImplementation</source>
        </item>
        <item>
          <title>ST2 sensor triggers on false positives</title>
          <dc:creator><![CDATA[singhabahu]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hi All,</p>
<p>We have implemented a solution with custom sensors where it watches to Kubernetes CRD object changes and create AWS resources based on that. It has been working fine for sometime now. Suddenly it triggered without any changes to the K8s CRD object. It happened twice apart within 8hrs and with the same pattern.  We didn’t notice any anomalies in the logs and it shows as trigger was invoked by the sensor.</p>
<pre><code>| MODIFIED, 6 nodes | bitesize.cb_chain             | stanley      | failed (235s elapsed)    | Wed, 21 Oct 2020 22:55:58 UTC | Wed, 21 Oct 2020 22:59:53 UTC |
| MODIFIED, 5 nodes | bitesize.cb_chain             | stanley      | canceled (7023s elapsed) | Wed, 21 Oct 2020 22:55:58 UTC | Thu, 22 Oct 2020 00:53:01 UTC |
| MODIFIED, 3 nodes | bitesize.cb_chain             | stanley      | failed (238s elapsed)    | Wed, 21 Oct 2020 22:55:58 UTC | Wed, 21 Oct 2020 22:59:56 UTC |
| ADDED, 3 nodes    | bitesize.cb_chain             | stanley      | succeeded (14s elapsed)  | Thu, 22 Oct 2020 08:49:16 UTC | Thu, 22 Oct 2020 08:49:30 UTC |
| MODIFIED, 6 nodes | bitesize.cb_chain             | stanley      | failed (243s elapsed)    | Thu, 22 Oct 2020 09:22:21 UTC | Thu, 22 Oct 2020 09:26:24 UTC |
| MODIFIED, 5 nodes | bitesize.cb_chain             | stanley      | failed (467s elapsed)    | Thu, 22 Oct 2020 09:22:21 UTC | Thu, 22 Oct 2020 09:30:08 UTC |
| MODIFIED, 3 nodes | bitesize.cb_chain             | stanley      | failed (472s elapsed)    | Thu, 22 Oct 2020 09:22:21 UTC | Thu, 22 Oct 2020 09:30:13 UTC |
</code></pre>
<p>Has anybody noticed similar kind of behavior with sensors?</p>
<p>ST2 version: 3.0.0</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/st2-sensor-triggers-on-false-positives/1463">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/st2-sensor-triggers-on-false-positives/1463</link>
          <pubDate>Mon, 26 Oct 2020 10:42:29 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1463</guid>
          <source url="https://forum.stackstorm.com/t/st2-sensor-triggers-on-false-positives/1463.rss">ST2 sensor triggers on false positives</source>
        </item>
        <item>
          <title>Passing an object from a webhook</title>
          <dc:creator><![CDATA[cyberkov]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hello!</p>
<p>I am trying to wrap my head around core.inject_trigger and having a really hard time to figure out it’s correct usage:</p>
<p>I am receiving a webhook from an external ticketing system and would like to emit a better formatted trigger back into the system.</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/cyberkov/st2-itrp/blob/master/tests/simulate_itrp_webhook.sh" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/cyberkov/st2-itrp/blob/master/tests/simulate_itrp_webhook.sh" target="_blank" rel="noopener nofollow ugc">cyberkov/st2-itrp/blob/master/tests/simulate_itrp_webhook.sh</a></h4>
<pre><code class="lang-sh">curl -X POST -0 -v -H 'Content-Type: application/json; charset=utf-8' \
http://localhost/api/v1/webhooks/itrp?st2-api-key=$ST2_API_KEY \
--data-binary @- &lt;&lt; EOF
{
      "account": "https://mydomain.at",
      "person_name": "John Doe",
      "account_id": "myaccount",
      "object_id": 88969,
      "payload": {
        "status": "assigned",
        "source": "recurrent",
        "member": null,
        "audit_line_id": 3733238,
        "team": {
          "sourceID": "10",
          "account": {
            "id": "myaccount",
            "name": "Parts unlimited"
          },
          "id": 35,
</code></pre>

  This file has been truncated. <a href="https://github.com/cyberkov/st2-itrp/blob/master/tests/simulate_itrp_webhook.sh" target="_blank" rel="noopener nofollow ugc">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>The json is properly parsed and ran through the rule:<br>
</p><aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/cyberkov/st2-itrp/blob/master/rules/ITRP_Webhook.yaml" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/cyberkov/st2-itrp/blob/master/rules/ITRP_Webhook.yaml" target="_blank" rel="noopener nofollow ugc">cyberkov/st2-itrp/blob/master/rules/ITRP_Webhook.yaml</a></h4>
<pre><code class="lang-yaml">---
pack: itrp
name: ITRP Webhook
description: Test QA ITRP
enabled: true
type:
  parameters: {}
  ref: standard
trigger:
  parameters:
    url: itrp
  type: core.st2.webhook
criteria: {}
action:
  ref: core.inject_trigger
  parameters:
    trigger: 'itrp.xxx'
    payload: '{{ trigger.body | tojson }}'
#  ref: core.echo
#  parameters:
</code></pre>

  This file has been truncated. <a href="https://github.com/cyberkov/st2-itrp/blob/master/rules/ITRP_Webhook.yaml" target="_blank" rel="noopener nofollow ugc">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>The commented echo works properly and the webhook content is shown. When using core.inject_trigger, the error I receive in the logs is:</p>
<pre><code class="lang-auto">2020-10-20 15:40:40,241 140700177833328 INFO enforcer [-] Invoking action core.inject_trigger for trigger_instance 5f8ee8d852364c03c0ca2c16 with params {"trigger": "itrp.xxx", "payload": "{{ trigger.body | tojson }}"}.
2020-10-20 15:40:40,274 140700177833328 ERROR enforcer [-] Failed kicking off execution for rule RuleDB(action=ActionExecutionSpecDB@140700175871568(ref="core.inject_trigger", parameters="{u'trigger': u'itrp.xxx', u'payload': u'{{ trigger.body | tojson }}'}"), context={}, criteria={}, description="Test QA ITRP", enabled=True, id=5f7f7a9052364ca2eae205bd, metadata_file="rules/ITRP-QA_Webhook.yaml", name="ITRP-
QA Webhook", pack="itrp", ref="itrp.ITRP-QA Webhook", tags=[], trigger="core.4fced566-b0d4-427a-ac10-8d88ae2011c8", type=RuleTypeSpecDB@140700175871696(ref="standard", parameters="{}"), uid="rule:itrp:ITRP-QA Webhook").
Traceback (most recent call last):
  File "/opt/stackstorm/st2/local/lib/python2.7/site-packages/st2reactor/rules/enforcer.py", line 97, in enforce
    execution_db = self._do_enforce()
  File "/opt/stackstorm/st2/local/lib/python2.7/site-packages/st2reactor/rules/enforcer.py", line 148, in _do_enforce
    additional_contexts=additional_contexts)
  File "/opt/stackstorm/st2/local/lib/python2.7/site-packages/st2reactor/rules/enforcer.py", line 204, in _invoke_action
    liveaction_db, execution_db = action_service.create_request(liveaction_db)
  File "/opt/stackstorm/st2/local/lib/python2.7/site-packages/st2common/services/action.py", line 106, in create_request
    allow_default_none=True)
  File "/opt/stackstorm/st2/local/lib/python2.7/site-packages/st2common/util/schema/__init__.py", line 304, in validate
    jsonschema.validate(instance=instance, schema=schema, cls=cls, *args, **kwargs)
  File "/opt/stackstorm/st2/local/lib/python2.7/site-packages/jsonschema/validators.py", line 541, in validate
    cls(schema, *args, **kwargs).validate(instance)
  File "/opt/stackstorm/st2/local/lib/python2.7/site-packages/jsonschema/validators.py", line 130, in validate
    raise error
ValidationError: u'{{ trigger.body | tojson }}' is not of type u'object', 'null'

Failed validating u'type' in schema['properties'][u'payload']:
    {u'description': u'Trigger payload.', u'type': [u'object', 'null']}
</code></pre>
<p>I prepared the github repo to be installed with <code>st2 pack install https://github.com/cyberkov/st2-itrp</code> but one would need to update the webhook url in <code>tests/simulate_itrp_webhook.sh</code> to try it.</p>
<p>When using <code>payload: '{{ trigger.body }}'</code> it was failing as well, which led me to the conversion to json.<br>
Did I miss anything or am I just “holding it wrong” <img src="https://emoji.discourse-cdn.com/apple/slight_smile.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Thanks a lot for your help!</p>
            <p><small>4 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/passing-an-object-from-a-webhook/1458">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/passing-an-object-from-a-webhook/1458</link>
          <pubDate>Tue, 20 Oct 2020 13:58:59 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1458</guid>
          <source url="https://forum.stackstorm.com/t/passing-an-object-from-a-webhook/1458.rss">Passing an object from a webhook</source>
        </item>
        <item>
          <title>core.st2.IntervalTimer</title>
          <dc:creator><![CDATA[kiran.lohar]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>I used core.st2.IntervalTimer this trigger to schedule my action. Now i want to know when(data and time) next action will run.<br>
how can we check schedule in stackstorm?</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/core-st2-intervaltimer/1171">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/core-st2-intervaltimer/1171</link>
          <pubDate>Wed, 15 Apr 2020 10:59:30 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-1171</guid>
          <source url="https://forum.stackstorm.com/t/core-st2-intervaltimer/1171.rss">core.st2.IntervalTimer</source>
        </item>
        <item>
          <title>Clarification on st2ctl reload --register-rules</title>
          <dc:creator><![CDATA[mike.dailey]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Just wanted a clarification on st2ctl reload --register-rules.</p>
<p>(1)  If one has added 1 new rule and there exist ‘n’ other rules, which remain unmodified, will only the new rule be loaded and the other rules will be untouched?  Or will all the rules actually be reloaded by this operation?   Is 'st2 rule create` less disruptive?</p>
<p>(2) Could any of existing, unmodified  ‘n’ rules possibly miss triggers during the time it takes to run st2ctl reload --register-rules?</p>
<p>I’m not entirely new to stackstorm, but  haven’t added rules until recently and wondered about operation of st2ctl reload vs say,  ‘st2 rule create’.</p>
<p>Many thanks in advance.</p>
<p>Mike</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/clarification-on-st2ctl-reload-register-rules/877">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/clarification-on-st2ctl-reload-register-rules/877</link>
          <pubDate>Tue, 15 Oct 2019 19:33:20 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-877</guid>
          <source url="https://forum.stackstorm.com/t/clarification-on-st2ctl-reload-register-rules/877.rss">Clarification on st2ctl reload --register-rules</source>
        </item>
        <item>
          <title>How to get the matched criteria values into action as parameters</title>
          <dc:creator><![CDATA[srimand]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hi Stackstorm Team</p>
<p>I am inspired from search operator mentioned in <a href="https://docs.stackstorm.com/rules.html" class="inline-onebox" rel="nofollow noopener">Rules — StackStorm 3.1.0 documentation</a>, i am using search operator to match a specific keyword from trigger which has a list of key:values</p>
<p>payload looks like below</p>
<p>{ ‘issue_fields’: [<br>
{<br>
‘servername’: ‘prodweb1’,<br>
‘servicename’: ‘check_ntp’<br>
},<br>
{<br>
‘servername’: ‘prodapp2’,<br>
‘servicename’: ‘check_tomcat’<br>
}]<br>
}</p>
<p>the trigger &amp; criteria looks good and the rule works fine with some basic action i am using in my scenario. How can i pass the iterating item value info to action when the pattern matches , i need the info to  be used inside action as host parameters, i am planning to use the value using jinja. This is for using ansible as my action.ref, nagdash/icinga as my sensor. Please help</p>
<h2>Ex:</h2>
<p>criteria:<br>
trigger.issue_fields:<br>
type: “search”<br>
# Controls whether all items in the trigger payload must match the child criteria,<br>
# or if any single item matching the child criteria is sufficient<br>
condition: any  # &lt;- <em>At least one</em> item must match all child patterns<br>
pattern:<br>
# Here our context is each item of the list<br>
# All of these patterns must match the item for the item to be considered a match<br>
# These are simply other operators applied to each item of the list<br>
item.field_name:<br>
type: “equals”<br>
pattern: “Status”</p>
<pre><code>    item.to_value:
      type: "equals"
      pattern: "Approved"
</code></pre>
<p>I would like to send the custom key info to a sample action whenever there is a match</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/how-to-get-the-matched-criteria-values-into-action-as-parameters/826">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/how-to-get-the-matched-criteria-values-into-action-as-parameters/826</link>
          <pubDate>Sat, 07 Sep 2019 18:52:48 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-826</guid>
          <source url="https://forum.stackstorm.com/t/how-to-get-the-matched-criteria-values-into-action-as-parameters/826.rss">How to get the matched criteria values into action as parameters</source>
        </item>
        <item>
          <title>Retrieving ordered entity list from rules API</title>
          <dc:creator><![CDATA[nirmaljayasinghe]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Is it possible to get an ordered list of rules (by due date or creation date) from the StackStorm rules API? (<a href="https://api.stackstorm.com/api/v1/rules/#/rule_controller.get_all" rel="nofollow noopener">https://api.stackstorm.com/api/v1/rules/#/rule_controller.get_all</a>)<br>
According to the API documentation there’s no way of specifying the order of the list of rules returned, only the size.</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/retrieving-ordered-entity-list-from-rules-api/823">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/retrieving-ordered-entity-list-from-rules-api/823</link>
          <pubDate>Thu, 05 Sep 2019 05:08:28 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-823</guid>
          <source url="https://forum.stackstorm.com/t/retrieving-ordered-entity-list-from-rules-api/823.rss">Retrieving ordered entity list from rules API</source>
        </item>
        <item>
          <title>Rule - last execution time</title>
          <dc:creator><![CDATA[pdenning]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Is it possible to get the timestamp and state of the last time a rule ran within the next execution of the rule?</p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/rule-last-execution-time/767">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/rule-last-execution-time/767</link>
          <pubDate>Wed, 24 Jul 2019 02:10:48 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-767</guid>
          <source url="https://forum.stackstorm.com/t/rule-last-execution-time/767.rss">Rule - last execution time</source>
        </item>
        <item>
          <title>Send data from Rule to Action</title>
          <dc:creator><![CDATA[hsilverio]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hi, I’m learning stacktorm. I’m having trouble passing data from Sensor -  Trigger -Rule to Action.</p>
<p>I have a sensor that checks for new rows in a MYSQL table.</p>
<p>The problem appears when I put the parameters in the Rule (commented in the example below “My Rule”). Action execution does not occur.<br>
If I comment the parameters, the rule successfully matches and the action executes successfully.</p>
<p>What will be the mistake?</p>
<p>The second question, how pass payload data from Rule to Action? Can you give an example explained?</p>
<p><strong>My Sensor:</strong></p>
<pre><code>			#hardcoded for debug
			payload = {'key':"test", 'count': int(count) + 1} 

			self.sensor_service.dispatch(trigger='monitor.sensor', payload=payload)
</code></pre>
<p>The payload matches the Rule criteria (checked in enforcement):</p>
<p><strong>My Rule:</strong></p>
<pre><code>---
name: rule_a
pack: monitor
description: Rule Dummy Data.
enabled: true
trigger:
    type: monitor.sensor
    parameters: {}
criteria:
    trigger.key:
        pattern: "test"
        type: "equals"       
action:
    ref: monitor.action_a
  #parameters:
  #key: "{{trigger.key}}"
</code></pre>
<p>Payload in the trigger:<br>
<code>{ "count": 47, "key": "test" }</code></p>
<p><strong>My Action def YAML</strong></p>
<pre><code>version: 1.0

description: Dummy action


tasks:
    main_from_database:
        action: monitor.action_def
        next:
          - when: &lt;% succeeded() %&gt;
            publish: &gt; 
                     method=&lt;% result().result.method %&gt; 
                     .....(more data)
            do:
              - api
          - when: &lt;% failed() %&gt;
            publish: stderr=&lt;% result().stderr %&gt;
            do: notify_on_error</code></pre>
            <p><small>3 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/send-data-from-rule-to-action/701">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/send-data-from-rule-to-action/701</link>
          <pubDate>Sat, 22 Jun 2019 11:42:12 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-701</guid>
          <source url="https://forum.stackstorm.com/t/send-data-from-rule-to-action/701.rss">Send data from Rule to Action</source>
        </item>
        <item>
          <title>Sns notifications to stackstorm webhook</title>
          <dc:creator><![CDATA[deepakdefender264]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>I am trying to send AWS SNS notifications to stackstorm webhooks but unable to confirm subscription as event is not getting logged on the webhook.<br>
In the nginx logs, I can see that subscribe confirm event hit the nginx but cannot find the payload of the sns event on webhook to fetch confirmation token or subscribbe url ?<br>
Is there a way to get it ?</p>
            <p><small>4 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/sns-notifications-to-stackstorm-webhook/691">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/sns-notifications-to-stackstorm-webhook/691</link>
          <pubDate>Thu, 13 Jun 2019 12:15:52 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-691</guid>
          <source url="https://forum.stackstorm.com/t/sns-notifications-to-stackstorm-webhook/691.rss">Sns notifications to stackstorm webhook</source>
        </item>
        <item>
          <title>Can rule criteria have references to items in a JSON array?</title>
          <dc:creator><![CDATA[djhaskin987]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>For example, within a rule, I have a criteria that looks like this:</p>
<pre><code>criteria:
  trigger.body.refChanges[0].type:
    type: "nequals"
    pattern: "DELETE"
</code></pre>
<p>What bothers me is that the criteria references the first element of a JSON array.</p>
<p>Is this a “legal” rule criteria?</p>
            <p><small>2 posts - 1 participant</small></p>
            <p><a href="https://forum.stackstorm.com/t/can-rule-criteria-have-references-to-items-in-a-json-array/658">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/can-rule-criteria-have-references-to-items-in-a-json-array/658</link>
          <pubDate>Mon, 20 May 2019 19:23:16 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-658</guid>
          <source url="https://forum.stackstorm.com/t/can-rule-criteria-have-references-to-items-in-a-json-array/658.rss">Can rule criteria have references to items in a JSON array?</source>
        </item>
        <item>
          <title>Zabbix trigger, how to pull parameters out of the payload</title>
          <dc:creator><![CDATA[jezk]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>I’m in the process of learning StackStorm and building a small proof of concept that takes a trigger from Zabbix and runs an action to restart a service on a Windows server.</p>
<p>I’d like some help in figuring out how to take a parameter from the following alert_message and use that as an option in a rule.<br>
Specifically I’m looking to take the hostname and event id out of the message text.</p>
<p>Thanks.</p>
<pre><code class="lang-auto">+-----------------+--------------------------------------------------------------+
| Property        | Value                                                        |
+-----------------+--------------------------------------------------------------+
| id              | 5cc854319a6fe026884e44df                                     |
| trigger         | zabbix.event_handler                                         |
| occurrence_time | 2019-04-30T23:57:05.000000Z                                  |
| payload         | {                                                            |
|                 |     "alert_sendto": "Admin",                                 |
|                 |     "extra_args": [],                                        |
|                 |     "alert_message": "{"items": [{"value": "99 %", "host":   |
|                 | "DC1", "name": "#3: CPU utilization", "key":                 |
|                 | "system.cpu.util[hrProcessorLoad.3]"}, {"value":             |
|                 | "*UNKNOWN*", "host": "*UNKNOWN*", "name": "*UNKNOWN*",       |
|                 | "key": "*UNKNOWN*"}, {"value": "*UNKNOWN*", "host":          |
|                 | "*UNKNOWN*", "name": "*UNKNOWN*", "key": "*UNKNOWN*"},       |
|                 | {"value": "*UNKNOWN*", "host": "*UNKNOWN*", "name":          |
|                 | "*UNKNOWN*", "key": "*UNKNOWN*"}, {"value": "*UNKNOWN*",     |
|                 | "host": "*UNKNOWN*", "name": "*UNKNOWN*", "key":             |
|                 | "*UNKNOWN*"}, {"value": "*UNKNOWN*", "host": "*UNKNOWN*",    |
|                 | "name": "*UNKNOWN*", "key": "*UNKNOWN*"}, {"value":          |
|                 | "*UNKNOWN*", "host": "*UNKNOWN*", "name": "*UNKNOWN*",       |
|                 | "key": "*UNKNOWN*"}, {"value": "*UNKNOWN*", "host":          |
|                 | "*UNKNOWN*", "name": "*UNKNOWN*", "key": "*UNKNOWN*"}],      |
|                 | "trigger": {"status": "PROBLEM", "id": "15970", "name": "#3: |
|                 | High CPU utilization"}, "event": {"id": "1120", "time":      |
|                 | "23:57:03"}}",                                               |
|                 |     "alert_subject": "PROBLEM: #3: High CPU utilization"     |
|                 | }                                                            |
| status          | processed                                                    |
+-----------------+--------------------------------------------------------------+
</code></pre>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/zabbix-trigger-how-to-pull-parameters-out-of-the-payload/633">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/zabbix-trigger-how-to-pull-parameters-out-of-the-payload/633</link>
          <pubDate>Sun, 05 May 2019 00:00:45 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-633</guid>
          <source url="https://forum.stackstorm.com/t/zabbix-trigger-how-to-pull-parameters-out-of-the-payload/633.rss">Zabbix trigger, how to pull parameters out of the payload</source>
        </item>
        <item>
          <title>Is there a way to access the trace tag of the rule execution from the rule execution itself</title>
          <dc:creator><![CDATA[djhaskin987]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>I want to know if I can access the trace tag from within a rule definition via jinja interpolation.</p>
            <p><small>7 posts - 3 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/is-there-a-way-to-access-the-trace-tag-of-the-rule-execution-from-the-rule-execution-itself/582">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/is-there-a-way-to-access-the-trace-tag-of-the-rule-execution-from-the-rule-execution-itself/582</link>
          <pubDate>Wed, 03 Apr 2019 18:44:49 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-582</guid>
          <source url="https://forum.stackstorm.com/t/is-there-a-way-to-access-the-trace-tag-of-the-rule-execution-from-the-rule-execution-itself/582.rss">Is there a way to access the trace tag of the rule execution from the rule execution itself</source>
        </item>
        <item>
          <title>Rule doesn&#39;t match sensor output</title>
          <dc:creator><![CDATA[Batman]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hi,</p>
<p>I found out my rule doesn’t match with sensor output but unsure whats wrong. Any insight will be of much help</p>
<p>Sensor output:</p>
<p><code>2019-02-01 06:21:48,072 INFO [-] Processing event: {u'check_result': {u'check_source': u'xxx', u'exit_status': 2.0, u'vars_before': {u'state_type': 1.0, u'reachable': True, u'state': 2.0, u'attempt': 1.0}, u'type': u'CheckResult', u'vars_after': {u'state_type': 1.0, u'reachable': True, u'state': 2.0, u'attempt': 1.0}, u'execution_start': 1549002107.592814, u'schedule_end': 1549002108.066733, u'performance_data': [u'available_upgrades=3;;;0', u'critical_updates=3;;;0'], u'state': 2.0, u'command': xxx'], u'execution_end': 1549002108.066672, u'active': True, u'output': u'APT CRITICAL: xxx ', u'schedule_start': 1549002107.592504}, u'timestamp': 1549002108.066818, u'host': u'xxx', u'type': u'CheckResult', u'service': u'apt'}</code></p>
<p>Rule:</p>
<pre><code>name: icinga_action
pack: icinga2
description: Post to chat when icinga2 service state changes
enabled: true
trigger:
  type: icinga2.event.state_change
#criteria:
#  trigger.type:
#    pattern: "u'state_type"
#    type: "eq"
#  trigger.state_type:
#    pattern: 0.1
#    type: gt
criteria:                              # optional
   trigger.type:
     type: "matchregex"
     pattern : "*exit_status*"
   trigger.state_type:
     type: "gt"
     pattern : "0.1"

action:
  ref: chatops.post_message
  parameters:
    message: Icinga2 service {{trigger.service}} on host {{trigger.host}} has changed its state to {{ trigger.state|int }}, state type {{ trigger.state_type|int }}
      {{trigger.check_result.output}}
    channel: 'xxxx'
</code></pre>
<p>Rule Doesn’t Match:</p>
<p>2019-02-01 06:28:53,216 INFO [-] Validating rule icinga2.icinga_action for event.state_change.<br>
2019-02-01 06:28:53,232 INFO [-] Validation for rule icinga2.icinga_action failed on     criteria -<br>
key: trigger.state_type<br>
pattern: 0.1<br>
type: gt<br>
payload: None<br>
2019-02-01 06:28:53,232 INFO [-] 0 rule(s) found to enforce for event.state_change.<br>
2019-02-01 06:28:53,232 INFO [-] === RULE DOES NOT MATCH ===</p>
            <p><small>4 posts - 3 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/rule-doesnt-match-sensor-output/463">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/rule-doesnt-match-sensor-output/463</link>
          <pubDate>Fri, 01 Feb 2019 06:33:02 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-463</guid>
          <source url="https://forum.stackstorm.com/t/rule-doesnt-match-sensor-output/463.rss">Rule doesn&#39;t match sensor output</source>
        </item>
        <item>
          <title>Reg AutoScaling Swarm</title>
          <dc:creator><![CDATA[sumitchandani]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hello Dimitri,</p>
<p>We are able to configure StackStorm however the rule swarm.on_pending_scaleup_aws is not running due to DesiredCapacity: “{{ st2kv.system.count | int + 1 }}”, we don’t have any action under st2 action list -p st2 with a name st2kv.system.count.</p>
<p>Could you please share the .py so we may create an action &amp; use the auto scaling.</p>
<p>Thanks &amp; Regards<br>
Sumit Roopchandani</p>
            <p><small>8 posts - 3 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/reg-autoscaling-swarm/442">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/reg-autoscaling-swarm/442</link>
          <pubDate>Thu, 17 Jan 2019 19:45:09 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-442</guid>
          <source url="https://forum.stackstorm.com/t/reg-autoscaling-swarm/442.rss">Reg AutoScaling Swarm</source>
        </item>
        <item>
          <title>AWS Action - Instance ID from Payload</title>
          <dc:creator><![CDATA[Tom_Depunkt]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hey there,</p>
<p>I’m currently working on an automation of our corresponding AWS account.<br>
The objective is, to have an automated action based on information about specific EC2 instances.</p>
<p>I’m currently trying to list all available EC2 instances, get their tags and perform an action if a specific key value pair exists.</p>
<p>My problem however is, that I can’t manage to use the Instance id as a parameter. The instance id is obtained via the payload, but the AWS action expects the instance id to be a string, so I can’t use <em>trigger.payload_instanceId</em> as it is used in the criteria field.</p>
<p>Is there any possible way, to use information from the payload in the action section?</p>
<p>Thanks in advance.</p>
<p>Regards,<br>
Tom</p>
            <p><small>6 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/aws-action-instance-id-from-payload/303">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/aws-action-instance-id-from-payload/303</link>
          <pubDate>Wed, 05 Sep 2018 09:23:38 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-303</guid>
          <source url="https://forum.stackstorm.com/t/aws-action-instance-id-from-payload/303.rss">AWS Action - Instance ID from Payload</source>
        </item>
        <item>
          <title>Is there a way to trigger event in workflow like inquiry and consume it in rules?</title>
          <dc:creator><![CDATA[jeff]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>Hi there,</p>
<p>Just wondering if there is a way to trigger an event in workflow1, and such event could be inspected by rules in order to trigger workflow2? I know that this could be done by calling workflow2 directly in workflow1, but if we can trigger event we don’t need to know the workflow2. That will be asynchronous and the failure of workflow2 won’t impact workflow1.</p>
<p>In inquiry we can specify ‘route: route_name’, and we can define rules to catch the ‘trigger.route’ and consume that event once an inquiry is created.  So could we do it the same way in our workflows?</p>
<p>I’ve looked thorough the sensor and it looks like the sensor can poll or accept passively from external system, then trigger event. But it seems that it could not be used for such scenario.</p>
<p>Thanks a lot.</p>
            <p><small>8 posts - 3 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/is-there-a-way-to-trigger-event-in-workflow-like-inquiry-and-consume-it-in-rules/199">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/is-there-a-way-to-trigger-event-in-workflow-like-inquiry-and-consume-it-in-rules/199</link>
          <pubDate>Tue, 03 Jul 2018 06:44:38 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-199</guid>
          <source url="https://forum.stackstorm.com/t/is-there-a-way-to-trigger-event-in-workflow-like-inquiry-and-consume-it-in-rules/199.rss">Is there a way to trigger event in workflow like inquiry and consume it in rules?</source>
        </item>
        <item>
          <title>Need to execute Dynamic Actions</title>
          <dc:creator><![CDATA[virenderdubey]]></dc:creator>
          <category>Rules</category>
          <description><![CDATA[
            <p>I have a requirement for executing some task, but the task name and their parameters are dynamic.  We have stored the task name and parameter in DB and a sensor polls the DB and trigger a rule for it.</p>
<p>In rule, In action section we specify the action name and their parameters.<br>
Action Parameters are dynamic as can be specified as {{ trigger.payload }} etc., but the action ref is static. I tried to find, how i can make it dynamic but invain.</p>
<p>Is it possible currently in StackStorm, i am using version 2.6</p>
<p>Also I found their is way of doing using mistral, but that is also static and i have to create an action for each action.<br>
</p><aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/StackStorm/st2/issues/3798" target="_blank" rel="nofollow noopener">github.com/StackStorm/st2</a>
  </header>
  <article class="onebox-body">
    <a href="https://github.com/nmaludy" rel="nofollow noopener">
<img src="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/beb82902608411704abc4d190cd4cbd42c749b3f.png" class="thumbnail onebox-avatar" width="96" height="96">
</a>

<h4><a href="https://github.com/StackStorm/st2/issues/3798" target="_blank" rel="nofollow noopener">Issue: Feature Request - Dynamic Mistral Tasks</a></h4>

<div class="date" style="margin-top:10px;">
	<div class="user" style="margin-top:10px;">
	opened by <a href="https://github.com/nmaludy" target="_blank" rel="nofollow noopener">nmaludy</a>
	on <a href="https://github.com/StackStorm/st2/issues/3798" target="_blank" rel="nofollow noopener">2017-10-20</a>
	</div>
	<div class="user">
	closed by <a href="https://github.com/m4dcoder" target="_blank" rel="nofollow noopener">m4dcoder</a>
	on <a href="https://github.com/StackStorm/st2/issues/3798" target="_blank" rel="nofollow noopener">2018-06-19</a>
	</div>
</div>

<pre class="content" style="white-space: pre-wrap;">High-level
I'm trying to create a Mistral workflow that has action and input values specified dynamically via input parameters from the execution...</pre>

<div class="labels">
 	<span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">feature</span>
 	<span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">workflows: mistral</span>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p></p>
<p>Thanks<br>
Virender Kumar</p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://forum.stackstorm.com/t/need-to-execute-dynamic-actions/173">Read full topic</a></p>
          ]]></description>
          <link>https://forum.stackstorm.com/t/need-to-execute-dynamic-actions/173</link>
          <pubDate>Mon, 18 Jun 2018 13:57:07 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">forum.stackstorm.com-topic-173</guid>
          <source url="https://forum.stackstorm.com/t/need-to-execute-dynamic-actions/173.rss">Need to execute Dynamic Actions</source>
        </item>
  </channel>
</rss>
