<!DOCTYPE html>
<html lang="en" class="desktop-view not-mobile-device text-size-normal anon">
<head>
    <meta charset="utf-8">
    <title>In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state - chatops -
        StackStorm Support (ARCHIVED)</title>
    <meta name="description" content="I have deployed st2 in k8s cluster using stackstorm provided helm chart for high availability. Slack is our hubot adapter.Facing the following issues in chatops 

Case : Running chatops.post_message - it‚Äôs execution show&amp;hellip;">
    <meta name="discourse_theme_id" content="2">
    <meta name="discourse_current_homepage" content="latest">
    <meta name="generator"
          content="Discourse 2.8.0.beta6 - https://github.com/discourse/discourse version a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787">
    <link rel="icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_32x32.PNG">
    <link rel="apple-touch-icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_180x180.PNG">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <link rel="canonical" href="1780.html"/>
    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "https://forum.stackstorm.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://forum.stackstorm.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml"
          title="StackStorm Support (ARCHIVED) Search">


    <link href="/../../stylesheets/color_definitions_base__2_3c5eec1ecf192052ea70b4afdab57a62bccc0604.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" class="light-scheme"/>

    <link href="/../../stylesheets/desktop_b2f2968742d41481357e0df259b51ce29f72481a.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" data-target="desktop"/>


    <meta name="fragment" content="!">


    <link id="manifest-link" rel="manifest" href="../../manifest.webmanifest" crossorigin="use-credentials">


    <link rel="alternate" type="application/rss+xml"
          title="RSS feed of &#39;In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state&#39;"
          href="1780.rss"/>
    <meta property="og:site_name" content="StackStorm Support (ARCHIVED)"/>
    <meta property="og:type" content="website"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:url"
          content="https://forum.stackstorm.com/t/in-k8s-deployment-chatops-post-result-and-chatops-post-message-delayed-or-stuck-in-running-state/1780"/>
    <meta name="twitter:url"
          content="https://forum.stackstorm.com/t/in-k8s-deployment-chatops-post-result-and-chatops-post-message-delayed-or-stuck-in-running-state/1780"/>
    <meta property="og:title"
          content="In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state"/>
    <meta name="twitter:title"
          content="In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state"/>
    <meta property="og:description"
          content="I have deployed st2 in k8s cluster using stackstorm provided helm chart for high availability. Slack is our hubot adapter.Facing the following issues in chatops   Case : Running chatops.post_message - it‚Äôs execution shows succeeded but didn‚Äôt get the message in slack channel. This is not happening always though. Randomly occurs. Case: chatops.post_result triggered by chatops.notify - this stuck in running state for more than 5 hours then posting the result to slack. Sometimes it stuck in running..."/>
    <meta name="twitter:description"
          content="I have deployed st2 in k8s cluster using stackstorm provided helm chart for high availability. Slack is our hubot adapter.Facing the following issues in chatops   Case : Running chatops.post_message - it‚Äôs execution shows succeeded but didn‚Äôt get the message in slack channel. This is not happening always though. Randomly occurs. Case: chatops.post_result triggered by chatops.notify - this stuck in running state for more than 5 hours then posting the result to slack. Sometimes it stuck in running..."/>
    <meta property="article:published_time" content="2021-07-14T04:41:57+00:00"/>
    <meta property="og:ignore_canonical" content="true"/>


    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "QAPage",
        "name": "In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state",
        "mainEntity": {
            "@type": "Question",
            "name": "In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state",
            "text": "I have deployed st2 in k8s cluster using stackstorm provided helm chart for high availability. Slack is our hubot adapter.Facing the following issues in chatops\n\nCase : Running chatops.post_message - it‚Äôs execution shows succeeded but didn‚Äôt get the message in slack channel. This is not happening a&hellip;",
            "upvoteCount": 0,
            "answerCount": 1,
            "dateCreated": "2021-07-14T04:41:57.540Z",
            "author": {
                "@type": "Person",
                "name": "MohanKumar"
            },
            "acceptedAnswer": {
                "@type": "Answer",
                "text": "I think issue is with Hubot event listener which is not getting the announcement event and posting the data back to slack.\n\nDouble check that st2chatops has the correct credentials to ST2. It is a normal ST2 API user, and the credentials are specified in /opt/stackstorm/chatops/st2chatops.env.",
                "upvoteCount": 0,
                "dateCreated": "2021-07-17T18:32:16.916Z",
                "url": "https://forum.stackstorm.com/t/in-k8s-deployment-chatops-post-result-and-chatops-post-message-delayed-or-stuck-in-running-state/1780/4",
                "author": {
                    "@type": "Person",
                    "name": "blag"
                }
            }
        }
    }
    </script>

    <meta id="data-discourse-setup" data-cdn="https://sjc6.discourse-cdn.com/standard10"
          data-base-url="https://forum.stackstorm.com" data-base-uri="" data-environment="production"
          data-letter-avatar-version="5_8fec8e114563efeaf5265573e510f08e"
          data-markdown-it-url="https://aws1.discourse-cdn.com/standard10/assets/markdown-it-bundle-31e9a9c535ca1801c26da78b0ff465821751a98f921c5cdc5457d7e5a69e9748.js"
          data-service-worker-url="service-worker.js" data-default-locale="en"
          data-asset-version="597e36448c9b51d0fa3b7e43ec1fd6d5" data-disable-custom-css="false"
          data-highlight-js-path="/highlight-js/forum.stackstorm.com/ac0f4aa001e1343346941766d72e0c1ae330832b.js"
          data-svg-sprite-path="/svg-sprite/forum.stackstorm.com/svg-2-c2ad434b1e06079c7e282124aed9938dc95b83ea.js"
          data-enable-js-error-reporting="true" data-color-scheme-is-dark="false" data-user-dark-scheme-id="-1"
          data-s3-cdn="https://aws1.discourse-cdn.com/standard10"
          data-s3-base-url="//discourse-cloud-file-uploads.s3.dualstack.us-west-2.amazonaws.com/standard10">

    <meta name="discourse/config/environment"
          content="%7B%22modulePrefix%22%3A%22discourse%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%22%2C%22locationType%22%3A%22auto%22%2C%22historySupportMiddleware%22%3Afalse%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_APPLICATION_TEMPLATE_WRAPPER%22%3Afalse%2C%22_DEFAULT_ASYNC_OBSERVERS%22%3Atrue%2C%22_JQUERY_INTEGRATION%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22discourse%22%2C%22version%22%3A%222.8.0.beta6%20a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787%22%2C%22exportApplicationGlobal%22%3Atrue%7D%7D"/>
</head>

<body class="">


<header class="d-header">
    <div class="wrap">
        <div class="contents clearfix">
            <div class="title">
                <a href="../../index.html">
                    <picture>
                        <img src="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png"
                             alt="StackStorm Support (ARCHIVED)" id="site-logo"/>
                    </picture>
                </a>
            </div>

        </div>
    </div>
</header>

<div id="main-outlet" class="wrap" role="main">
    <!-- preload-content: -->

    <!-- EOF START -->
    <div class="container" id="main-container">
        <div id="ember11" class="ember-view"></div>
        <div id="ember12" class="controls ember-view"><!----></div>
        <div id="ember13" class="ember-view"><!----></div>
        <div id="ember14" class="ember-view">
            <div class="row">
                <div id="global-notice-alert-read-only" class="alert alert-info alert-read-only">
                    <!----> <span class="text">This site is in read only mode. Please continue to browse, but replying, likes, and other actions are disabled for now.</span>

                    <!---->    </div>
            </div>
            <div class="row">
                <div id="global-notice-alert-global-notice" class="alert alert-info alert-global-notice">
                    <!----> <span class="text"><h3>‚ö†Ô∏è We've moved!</h3>  <p> Hi there!<br><br> To reduce project dependency on 3rd party paid services the StackStorm TSC has decided to move the Q/A from this forum to <a
                        href="https://github.com/StackStorm/st2/discussions">Github Discussions</a>. This will make user experience better integrated with the native Github flow, as well as the questions closer to the community where they can provide answers. </p>  <p> Use üîó <b><a
                        href="https://github.com/StackStorm/st2/discussions" class="active">Github Discussions</a></b> to ask your questions. </p></span>

                    <!---->    </div>
            </div>
        </div>
        <div id="ember17" class="hidden create-topics-notice ember-view"><!----></div>
        <!---->
    </div>
    <!-- EOF END -->
    <div id="topic-title">
        <h1>
            <a href="1780.html">In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in
                running state</a>
        </h1>


        <div class="topic-category">
            <div class='discourse-tags list-tags'>
                <a href='../../tag/chatops' class='discourse-tag' rel="tag">chatops</a>
            </div>
        </div>
    </div>


    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/mohan28'><span itemprop='name'>mohan28</span></a>
            (MohanKumar)
          </span>

            <link itemprop="mainEntityOfPage" href="1780.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-14T04:41:57Z' class='post-time'>
                July 14, 2021,  4:41am
              </time>
              <meta itemprop='dateModified' content='2021-07-14T04:41:57Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>I have deployed st2 in k8s cluster using stackstorm provided helm chart for high availability. Slack is
                our hubot adapter.Facing the following issues in chatops</p>
            <ol>
                <li>Case : Running chatops.post_message - it‚Äôs execution shows succeeded but didn‚Äôt get the message in
                    slack channel. This is not happening always though. Randomly occurs.
                </li>
                <li>Case: chatops.post_result triggered by chatops.notify - this stuck in running state for more than 5
                    hours then posting the result to slack. Sometimes it stuck in running state forever.
                </li>
            </ol>
            <p>Please let me know if you guys faced this before and how you resolved it or suggest a way to overcome
                this issues.</p>
        </div>

        <meta itemprop='headline'
              content='In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state'>
        <meta itemprop='keywords' content='chatops'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/blag'><span itemprop='name'>blag</span></a>
            
          </span>

            <link itemprop="mainEntityOfPage" href="1780.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-15T19:48:59Z' class='post-time'>
                July 15, 2021,  7:48pm
              </time>
              <meta itemprop='dateModified' content='2021-07-15T19:48:59Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>This is a known issue.</p>
            <p>StackStorm ChatOps is configured in two<sup>1</sup> steps:</p>
            <ul>
                <li>StackStorm &lt;‚Äì&gt; st2chatops</li>
                <li>st2chatops &lt;‚Äì&gt; Slack</li>
            </ul>
            <p>You seem to have the StackStorm &lt;‚Äì&gt; st2chatops working, although it can‚Äôt hurt to double check
                that.</p>
            <p>But the st2chatops &lt;‚Äì&gt; Slack integration doesn‚Äôt appear to be working for you. You must use a
                Legacy Bot Token from Slack, a modern token will not work.</p>
            <p><sup>1</sup> Technically it‚Äôs three steps, as you need to ensure that the Slack ‚Üí st2chatops websockets
                connection works, and that the st2chatops ‚Üí Slack HTTP connection works, but both use the same
                authentication token from Slack.</p>
        </div>

        <meta itemprop='headline'
              content='In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/mohan28'><span itemprop='name'>mohan28</span></a>
            (MohanKumar)
          </span>

            <link itemprop="mainEntityOfPage" href="1780.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-16T04:32:47Z' class='post-time'>
                July 16, 2021,  4:32am
              </time>
              <meta itemprop='dateModified' content='2021-07-16T04:32:47Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Thank you for the updates.</p>
            <p>We are using the classic app bot token.<br>
                Now, chatops.post_result is getting succeeded but slack channel is not receiving the result message.
                Sometimes it receives message though.<br>
                I think issue is with Hubot event listener which is not getting the announcement event and posting the
                data back to slack.</p>
            <p>As mentioned in the st2 HA doc, Hubot does have some limitations so single instance of chatops is used.
                Not sure if that‚Äôs causing this problem though.</p>
            <p>Please suggest if any work around can be done in this regard.</p>
        </div>

        <meta itemprop='headline'
              content='In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/blag'><span itemprop='name'>blag</span></a>
            
          </span>

            <link itemprop="mainEntityOfPage" href="1780.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-17T18:32:16Z' class='post-time'>
                July 17, 2021,  6:32pm
              </time>
              <meta itemprop='dateModified' content='2021-07-17T18:32:16Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <blockquote>
                <p>I think issue is with Hubot event listener which is not getting the announcement event and posting
                    the data back to slack.</p>
            </blockquote>
            <p>Double check that st2chatops has the correct credentials to ST2. It is a normal ST2 API user, and the
                credentials are specified in <code>/opt/stackstorm/chatops/st2chatops.env</code>.</p>
        </div>

        <meta itemprop='headline'
              content='In k8s deployment, chatops.post_result and chatops.post_message delayed or stuck in running state'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>


    <!-- :preload-content -->
    <footer class="noscript-footer-nav">
        <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
            <a href='../../index.html'>Home</a>
            <a href="../../categories.html">Categories</a>
            <a href="https://forum.stackstorm.com/guidelines">FAQ/Guidelines</a>
            <a href="../../tos.html">Terms of Service</a>
            <a href="../../privacy.html">Privacy Policy</a>
        </nav>
    </footer>
</div>

<footer id='noscript-footer'>
    <p>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>


<section id='main'>
</section>


</body>
</html>
