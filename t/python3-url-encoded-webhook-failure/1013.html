<!DOCTYPE html>
<html lang="en" class="desktop-view not-mobile-device text-size-normal anon">
<head>
    <meta charset="utf-8">
    <title>Python3 - URL Encoded Webhook Failure - API - StackStorm Support (ARCHIVED)</title>
    <meta name="description" content="I have been testing URL Encoded webhooks and I keep running into an error where Stackstorm is converting the URL Encoded text data into binary format which then causes it to fail when trying to encode it as JSON data. 
T&amp;hellip;">
    <meta name="discourse_theme_id" content="2">
    <meta name="discourse_current_homepage" content="latest">
    <meta name="generator"
          content="Discourse 2.8.0.beta6 - https://github.com/discourse/discourse version a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787">
    <link rel="icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_32x32.PNG">
    <link rel="apple-touch-icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_180x180.PNG">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <link rel="canonical" href="1013.html"/>
    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "https://forum.stackstorm.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://forum.stackstorm.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml"
          title="StackStorm Support (ARCHIVED) Search">


    <link href="/../../stylesheets/color_definitions_base__2_3c5eec1ecf192052ea70b4afdab57a62bccc0604.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" class="light-scheme"/>

    <link href="/../../stylesheets/desktop_b2f2968742d41481357e0df259b51ce29f72481a.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" data-target="desktop"/>


    <meta name="fragment" content="!">


    <link id="manifest-link" rel="manifest" href="../../manifest.webmanifest" crossorigin="use-credentials">


    <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Python3 - URL Encoded Webhook Failure&#39;"
          href="1013.rss"/>
    <meta property="og:site_name" content="StackStorm Support (ARCHIVED)"/>
    <meta property="og:type" content="website"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:url" content="https://forum.stackstorm.com/t/python3-url-encoded-webhook-failure/1013"/>
    <meta name="twitter:url" content="https://forum.stackstorm.com/t/python3-url-encoded-webhook-failure/1013"/>
    <meta property="og:title" content="Python3 - URL Encoded Webhook Failure"/>
    <meta name="twitter:title" content="Python3 - URL Encoded Webhook Failure"/>
    <meta property="og:description"
          content="I have been testing URL Encoded webhooks and I keep running into an error where Stackstorm is converting the URL Encoded text data into binary format which then causes it to fail when trying to encode it as JSON data.  The simple URL Encoded body data I have been testing with is:  MyVariableOne=ValueOne&amp;MyVariableTwo=ValueTwo  When posting this to my webook URL using Postman, I get the an HTPP 500 error with an ‚ÄúInternal Server Error‚Äù message response for Stackstrom and the following debug outpu..."/>
    <meta name="twitter:description"
          content="I have been testing URL Encoded webhooks and I keep running into an error where Stackstorm is converting the URL Encoded text data into binary format which then causes it to fail when trying to encode it as JSON data.  The simple URL Encoded body data I have been testing with is:  MyVariableOne=ValueOne&amp;MyVariableTwo=ValueTwo  When posting this to my webook URL using Postman, I get the an HTPP 500 error with an ‚ÄúInternal Server Error‚Äù message response for Stackstrom and the following debug outpu..."/>
    <meta name="twitter:label1" value="Reading time"/>
    <meta name="twitter:data1" value="3 mins üïë"/>
    <meta name="twitter:label2" value="Likes"/>
    <meta name="twitter:data2" value="1 ‚ù§"/>
    <meta property="article:published_time" content="2020-01-27T12:16:58+00:00"/>
    <meta property="og:ignore_canonical" content="true"/>


    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "QAPage",
        "name": "Python3 - URL Encoded Webhook Failure",
        "mainEntity": {
            "@type": "Question",
            "name": "Python3 - URL Encoded Webhook Failure",
            "text": "I have been testing URL Encoded webhooks and I keep running into an error where Stackstorm is converting the URL Encoded text data into binary format which then causes it to fail when trying to encode it as JSON data.\n\nThe simple URL Encoded body data I have been testing with is:\n\nMyVariableOne=Valu&hellip;",
            "upvoteCount": 0,
            "answerCount": 0,
            "dateCreated": "2020-01-27T12:16:58.792Z",
            "author": {
                "@type": "Person",
                "name": "James Reid"
            }
        }
    }
    </script>

    <meta id="data-discourse-setup" data-cdn="https://sjc6.discourse-cdn.com/standard10"
          data-base-url="https://forum.stackstorm.com" data-base-uri="" data-environment="production"
          data-letter-avatar-version="5_8fec8e114563efeaf5265573e510f08e"
          data-markdown-it-url="https://aws1.discourse-cdn.com/standard10/assets/markdown-it-bundle-31e9a9c535ca1801c26da78b0ff465821751a98f921c5cdc5457d7e5a69e9748.js"
          data-service-worker-url="service-worker.js" data-default-locale="en"
          data-asset-version="597e36448c9b51d0fa3b7e43ec1fd6d5" data-disable-custom-css="false"
          data-highlight-js-path="/highlight-js/forum.stackstorm.com/ac0f4aa001e1343346941766d72e0c1ae330832b.js"
          data-svg-sprite-path="/svg-sprite/forum.stackstorm.com/svg-2-c2ad434b1e06079c7e282124aed9938dc95b83ea.js"
          data-enable-js-error-reporting="true" data-color-scheme-is-dark="false" data-user-dark-scheme-id="-1"
          data-s3-cdn="https://aws1.discourse-cdn.com/standard10"
          data-s3-base-url="//discourse-cloud-file-uploads.s3.dualstack.us-west-2.amazonaws.com/standard10">

    <meta name="discourse/config/environment"
          content="%7B%22modulePrefix%22%3A%22discourse%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%22%2C%22locationType%22%3A%22auto%22%2C%22historySupportMiddleware%22%3Afalse%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_APPLICATION_TEMPLATE_WRAPPER%22%3Afalse%2C%22_DEFAULT_ASYNC_OBSERVERS%22%3Atrue%2C%22_JQUERY_INTEGRATION%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22discourse%22%2C%22version%22%3A%222.8.0.beta6%20a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787%22%2C%22exportApplicationGlobal%22%3Atrue%7D%7D"/>
</head>

<body class="">


<header class="d-header">
    <div class="wrap">
        <div class="contents clearfix">
            <div class="title">
                <a href="../../index.html">
                    <picture>
                        <img src="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png"
                             alt="StackStorm Support (ARCHIVED)" id="site-logo"/>
                    </picture>
                </a>
            </div>

        </div>
    </div>
</header>

<div id="main-outlet" class="wrap" role="main">
    <!-- preload-content: -->

    <!-- EOF START -->
    <div class="container" id="main-container">
        <div id="ember11" class="ember-view"></div>
        <div id="ember12" class="controls ember-view"><!----></div>
        <div id="ember13" class="ember-view"><!----></div>
        <div id="ember14" class="ember-view">
            <div class="row">
                <div id="global-notice-alert-read-only" class="alert alert-info alert-read-only">
                    <!----> <span class="text">This site is in read only mode. Please continue to browse, but replying, likes, and other actions are disabled for now.</span>

                    <!---->    </div>
            </div>
            <div class="row">
                <div id="global-notice-alert-global-notice" class="alert alert-info alert-global-notice">
                    <!----> <span class="text"><h3>‚ö†Ô∏è We've moved!</h3>  <p> Hi there!<br><br> To reduce project dependency on 3rd party paid services the StackStorm TSC has decided to move the Q/A from this forum to <a
                        href="https://github.com/StackStorm/st2/discussions">Github Discussions</a>. This will make user experience better integrated with the native Github flow, as well as the questions closer to the community where they can provide answers. </p>  <p> Use üîó <b><a
                        href="https://github.com/StackStorm/st2/discussions" class="active">Github Discussions</a></b> to ask your questions. </p></span>

                    <!---->    </div>
            </div>
        </div>
        <div id="ember17" class="hidden create-topics-notice ember-view"><!----></div>
        <!---->
    </div>
    <!-- EOF END -->
    <div id="topic-title">
        <h1>
            <a href="1013.html">Python3 - URL Encoded Webhook Failure</a>
        </h1>

        <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/core-st2-platform-issues/6" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Platform</span>
              </span>
            </a>
            <meta itemprop="position" content="1"/>
          </span>
            <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/core-st2-platform-issues/stackstorm-api-related-issues/7" class="badge-wrapper bullet"
               itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>API</span>
              </span>
            </a>
            <meta itemprop="position" content="2"/>
          </span>
        </div>

        <div class="topic-category">
            <div class='discourse-tags list-tags'>
                <a href='../../tag/bug' class='discourse-tag' rel="tag">bug</a>,
                <a href='../../tag/python3' class='discourse-tag' rel="tag">python3</a>
            </div>
        </div>
    </div>


    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/jamesdreid'><span
                    itemprop='name'>jamesdreid</span></a>
            (James Reid)
          </span>

            <link itemprop="mainEntityOfPage" href="1013.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-01-27T12:16:58Z' class='post-time'>
                January 27, 2020, 12:16pm
              </time>
              <meta itemprop='dateModified' content='2020-01-27T22:30:13Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>I have been testing URL Encoded webhooks and I keep running into an error where Stackstorm is converting
                the URL Encoded text data into binary format which then causes it to fail when trying to encode it as
                JSON data.</p>
            <p>The simple URL Encoded body data I have been testing with is:</p>
            <p>MyVariableOne=ValueOne&amp;MyVariableTwo=ValueTwo</p>
            <p>When posting this to my webook URL using Postman, I get the an HTPP 500 error with an ‚ÄúInternal Server
                Error‚Äù message response for Stackstrom and the following debug output in the API logs:</p>
            <pre><code>[2020-01-27 11:49:57 +0000] [10770] [DEBUG] POST /v1/webhooks/valero_cpe
2020-01-27 11:49:57,579 140064340756784 DEBUG (unknown file) [-] Match path: /v1/webhooks/valero_cpe
2020-01-27 11:49:57,580 140064340756784 INFO (unknown file) [-] 684b74a5-5ea6-4602-9006-2a9a0033710c - POST /v1/webhooks/valero_cpe with query={} (method='POST',path='/v1/webhooks/valero_cpe',remote_addr='127.0.0.1',query={},request_id='684b74a5-5ea6-4602-9006-2a9a0033710c')
2020-01-27 11:49:57,580 140064340756784 DEBUG (unknown file) [-] Received call with WebOb: POST /v1/webhooks/valero_cpe HTTP/1.0
Accept: */*
Accept-Encoding: gzip, deflate, br
Cache-Control: no-cache
Content-Length: 46
Content-Type: application/x-www-form-urlencoded
Host: 81296fd8.ngrok.io,81296fd8.ngrok.io
Postman-Token: 00a125ee-11b4-46fe-9500-75f5d9a811d8
St2-Api-Key: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
User-Agent: PostmanRuntime/7.22.0
X-Forwarded-For: 68.187.78.177, 127.0.0.1
X-Forwarded-Proto: https
X-Real-Ip: 127.0.0.1
X-Request-Id: 684b74a5-5ea6-4602-9006-2a9a0033710c

MyVariableOne=ValueOne&amp;MyVariableTwo=ValueTwo

2020-01-27 11:49:57,580 140064340756784 DEBUG (unknown file) [-] Match path: /v1/webhooks/valero_cpe
2020-01-27 11:49:57,581 140064340756784 DEBUG (unknown file) [-] Parsed endpoint: {'operationId': 'st2api.controllers.v1.webhooks:webhooks_controller.post', 'x-requirements': {'hook': '.*'}, 'description': 'Trigger a webhook.\n', 'parameters': [{'name': 'hook', 'in': 'path', 'description': 'Webhook path', 'type': 'string', 'required': True}, {'name': 'webhook_body_api', 'in': 'body', 'description': 'Webhook payload', 'schema': {'$ref': '#/definitions/WebhookBody'}}], 'x-parameters': [{'name': 'headers', 'in': 'request', 'description': 'List of headers attached to the request.'}, {'name': 'user', 'in': 'context', 'x-as': 'requester_user', 'description': 'User performing the operation.'}], 'responses': {'202': {'description': 'Single action being created', 'schema': {'$ref': '#/definitions/WebhookBody'}, 'examples': {'application/json': {'ref': 'core.local'}}}, 'default': {'description': 'Unexpected error', 'schema': {'$ref': '#/definitions/Error'}}}}
2020-01-27 11:49:57,581 140064340756784 DEBUG (unknown file) [-] Parsed path_vars: {'hook': 'valero_cpe'}
2020-01-27 11:49:57,583 140064340756784 AUDIT (unknown file) [-] API key with id "5ddbbb999e14ef34dced4bfc" is validated.
2020-01-27 11:49:57,587 140064340756784 DEBUG (unknown file) [-] Dispatching trigger {'uid': 'trigger:core:8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d:f7c2bb36b9bae14671835604c4167e1c', 'ref': 'core.8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d', 'name': '8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d', 'pack': 'core', 'type': 'core.st2.webhook', 'parameters': {'url': '/valero_cpe'}, 'id': '5df13f759e14ef0c5f1bcc3a'} with payload {'headers': {'Host': '81296fd8.ngrok.io,81296fd8.ngrok.io', 'X-Real-Ip': '127.0.0.1', 'X-Forwarded-For': '68.187.78.177, 127.0.0.1', 'Content-Length': '46', 'St2-Api-Key': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'Content-Type': 'application/x-www-form-urlencoded', 'User-Agent': 'PostmanRuntime/7.22.0', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Postman-Token': '00a125ee-11b4-46fe-9500-75f5d9a811d8', 'Accept-Encoding': 'gzip, deflate, br', 'X-Forwarded-Proto': 'https', 'X-Request-Id': '684b74a5-5ea6-4602-9006-2a9a0033710c'}, 'body': {b'MyVariableOne': [b'ValueOne'], b'MyVariableTwo': [b'ValueTwo\n']}}.
2020-01-27 11:49:57,590 140064340756784 DEBUG (unknown file) [-] Dispatching trigger (trigger={'uid': 'trigger:core:8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d:f7c2bb36b9bae14671835604c4167e1c', 'ref': 'core.8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d', 'name': '8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d', 'pack': 'core', 'type': 'core.st2.webhook', 'parameters': {'url': '/valero_cpe'}, 'id': '5df13f759e14ef0c5f1bcc3a'},payload={'trigger': {'uid': 'trigger:core:8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d:f7c2bb36b9bae14671835604c4167e1c', 'ref': 'core.8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d', 'name': '8e1eb20c-33f6-4e4e-b0e9-dc166b37be7d', 'pack': 'core', 'type': 'core.st2.webhook', 'parameters': {'url': '/valero_cpe'}, 'id': '5df13f759e14ef0c5f1bcc3a'}, 'payload': {'headers': {'Host': '81296fd8.ngrok.io,81296fd8.ngrok.io', 'X-Real-Ip': '127.0.0.1', 'X-Forwarded-For': '68.187.78.177, 127.0.0.1', 'Content-Length': '46', 'St2-Api-Key': 'MzE0NDQ2MzI1YjhiZDFjNmRjZjE5NmUzODEyYTViYmZjNzY3YjYyNzVlNGMxMGQ3ODQ3NzI0YzE0YjNjNjVjNA', 'Content-Type': 'application/x-www-form-urlencoded', 'User-Agent': 'PostmanRuntime/7.22.0', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Postman-Token': '00a125ee-11b4-46fe-9500-75f5d9a811d8', 'Accept-Encoding': 'gzip, deflate, br', 'X-Forwarded-Proto': 'https', 'X-Request-Id': '684b74a5-5ea6-4602-9006-2a9a0033710c'}, 'body': {b'MyVariableOne': [b'ValueOne'], b'MyVariableTwo': [b'ValueTwo\n']}}, 'trace_context': &lt;st2common.models.api.trace.TraceContext object at 0x7f634564e518&gt;})
2020-01-27 11:49:57,591 140064340756784 DEBUG channel [-] using channel_id: 1
2020-01-27 11:49:57,596 140064340756784 DEBUG channel [-] Channel open
2020-01-27 11:49:57,600 140064340756784 DEBUG channel [-] Closed channel #1
2020-01-27 11:49:57,601 140064340756784 ERROR (unknown file) [-] Failed to call controller function "post" for operation "st2api.controllers.v1.webhooks:webhooks_controller.post": key b'MyVariableOne' is not a string
Traceback (most recent call last):
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/router.py", line 515, in __call__
    resp = func(**kw)
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2api/controllers/v1/webhooks.py", line 172, in post
    return Response(json=body, status=http_client.ACCEPTED)
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/router.py", line 150, in __init__
    body = json_encode(json_body).encode('UTF-8')
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/util/jsonify.py", line 45, in json_encode
    return json.dumps(obj, cls=GenericJSON, indent=indent)
  File "/usr/lib/python3.6/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/lib/python3.6/json/encoder.py", line 201, in encode
    chunks = list(chunks)
  File "/usr/lib/python3.6/json/encoder.py", line 430, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/lib/python3.6/json/encoder.py", line 376, in _iterencode_dict
    raise TypeError("key " + repr(key) + " is not a string")
TypeError: key b'MyVariableOne' is not a string
2020-01-27 11:49:57,601 140064340756784 ERROR (unknown file) [-] API call failed: key b'MyVariableOne' is not a string
Traceback (most recent call last):
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/middleware/error_handling.py", line 48, in __call__
    return self.app(environ, start_response)
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/middleware/streaming.py", line 47, in __call__
    return self.app(environ, start_response)
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/router.py", line 594, in as_wsgi
    resp = self(req)
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/router.py", line 519, in __call__
    raise e
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/router.py", line 515, in __call__
    resp = func(**kw)
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2api/controllers/v1/webhooks.py", line 172, in post
    return Response(json=body, status=http_client.ACCEPTED)
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/router.py", line 150, in __init__
    body = json_encode(json_body).encode('UTF-8')
  File "/opt/stackstorm/st2/lib/python3.6/site-packages/st2common/util/jsonify.py", line 45, in json_encode
    return json.dumps(obj, cls=GenericJSON, indent=indent)
  File "/usr/lib/python3.6/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/lib/python3.6/json/encoder.py", line 201, in encode
    chunks = list(chunks)
  File "/usr/lib/python3.6/json/encoder.py", line 430, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/lib/python3.6/json/encoder.py", line 376, in _iterencode_dict
    raise TypeError("key " + repr(key) + " is not a string")
TypeError: key b'MyVariableOne' is not a string (_exception_class='TypeError',_exception_message="key b'MyVariableOne' is not a string",_exception_data={})
2020-01-27 11:49:57,606 140064340756784 DEBUG (unknown file) [-] Match path: /v1/webhooks/valero_cpe
2020-01-27 11:49:57,607 140064340756784 INFO (unknown file) [-] 684b74a5-5ea6-4602-9006-2a9a0033710c - 500 46 27.193ms (method='POST',path='/v1/webhooks/valero_cpe',remote_addr='127.0.0.1',status=500,runtime=27.193,content_length=46,request_id='684b74a5-5ea6-4602-9006-2a9a0033710c')
2020-01-27 11:49:57,608 140064340756784 DEBUG (unknown file) [-] 684b74a5-5ea6-4602-9006-2a9a0033710c - 500 46 27.193ms
b'{\n    "faultstring": "Internal Server Error"\n}' (method='POST',path='/v1/webhooks/valero_cpe',remote_addr='127.0.0.1',status=500,runtime=27.193,content_length=46,request_id='684b74a5-5ea6-4602-9006-2a9a0033710c',result='b\'{\\n    "faultstring": "Internal Server Error"\\n}\'')
[2020-01-27 11:49:57 +0000] [10770] [DEBUG] Closing connection.</code></pre>
        </div>

        <meta itemprop='headline' content='Python3 - URL Encoded Webhook Failure'>
        <meta itemprop='keywords' content='bug, python3'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/jamesdreid'><span
                    itemprop='name'>jamesdreid</span></a>
            (James Reid)
          </span>

            <link itemprop="mainEntityOfPage" href="1013.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-01-27T22:12:25Z' class='post-time'>
                January 27, 2020, 10:12pm
              </time>
              <meta itemprop='dateModified' content='2020-01-27T22:12:25Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>I believe I have isolated the issue and it is due to the encoding for the body data that is returned by
                the WSGI server. In Python2, the body data was returned as a string so line 404 (below) in the router.py
                file worked properly to process the URL encoded body data.</p>
            <p><code> data = urlparse.parse_qs(req.body)</code></p>
            <p>In Python3, the WSGI server encoded the body data as a byte string and it needed to be decoded as a
                string before being processed further. Changing line 404 to the following, corrected the error and
                processed the web hook data properly:</p>
            <p><code>data = urlparse.parse_qs(req.body.decode('utf-8'))</code></p>
            <p>Not sure if this change will break anything else, but I will happily open a bug report/tracking issue if
                needed and I can figure out the process.</p>
            <p>Thanks</p>
        </div>

        <meta itemprop='headline' content='Python3 - URL Encoded Webhook Failure'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="1"/>
            <span class='post-likes'>1 Like</span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/armab'><span itemprop='name'>armab</span></a>
            (Eugen Cusmaunsa)
          </span>

            <link itemprop="mainEntityOfPage" href="1013.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-01-27T22:32:20Z' class='post-time'>
                January 27, 2020, 10:32pm
              </time>
              <meta itemprop='dateModified' content='2020-01-27T22:32:20Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Yes, please report a bug in <code>stackstorm/st2</code> and having a PR for it would be just awesome!</p>
        </div>

        <meta itemprop='headline' content='Python3 - URL Encoded Webhook Failure'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/jamesdreid'><span
                    itemprop='name'>jamesdreid</span></a>
            (James Reid)
          </span>

            <link itemprop="mainEntityOfPage" href="1013.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-01-28T21:43:51Z' class='post-time'>
                January 28, 2020,  9:43pm
              </time>
              <meta itemprop='dateModified' content='2020-01-28T21:43:51Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Bug report submitted.</p>
            <h1><span class="hashtag">#4853</span></h1>
        </div>

        <meta itemprop='headline' content='Python3 - URL Encoded Webhook Failure'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>


    <!-- :preload-content -->
    <footer class="noscript-footer-nav">
        <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
            <a href='../../index.html'>Home</a>
            <a href="../../categories.html">Categories</a>
            <a href="https://forum.stackstorm.com/guidelines">FAQ/Guidelines</a>
            <a href="../../tos.html">Terms of Service</a>
            <a href="../../privacy.html">Privacy Policy</a>
        </nav>
    </footer>
</div>

<footer id='noscript-footer'>
    <p>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>


<section id='main'>
</section>


</body>
</html>
