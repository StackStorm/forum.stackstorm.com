<!DOCTYPE html>
<html lang="en" class="desktop-view not-mobile-device text-size-normal anon">
<head>
    <meta charset="utf-8">
    <title>Send data from Rule to Action - Rules - StackStorm Support (ARCHIVED)</title>
    <meta name="description" content="Hi, I‚Äôm learning stacktorm. I‚Äôm having trouble passing data from Sensor -  Trigger -Rule to Action. 
I have a sensor that checks for new rows in a MYSQL table. 
The problem appears when I put the parameters in the Rule (&amp;hellip;">
    <meta name="discourse_theme_id" content="2">
    <meta name="discourse_current_homepage" content="latest">
    <meta name="generator"
          content="Discourse 2.8.0.beta6 - https://github.com/discourse/discourse version a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787">
    <link rel="icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_32x32.PNG">
    <link rel="apple-touch-icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_180x180.PNG">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <link rel="canonical" href="701.html"/>
    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "https://forum.stackstorm.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://forum.stackstorm.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }</script>
    <link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml"
          title="StackStorm Support (ARCHIVED) Search">


    <link href="/../../stylesheets/color_definitions_base__2_3c5eec1ecf192052ea70b4afdab57a62bccc0604.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" class="light-scheme"/>

    <link href="/../../stylesheets/desktop_b2f2968742d41481357e0df259b51ce29f72481a.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" data-target="desktop"/>


    <meta name="fragment" content="!">


    <link id="manifest-link" rel="manifest" href="../../manifest.webmanifest" crossorigin="use-credentials">


    <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Send data from Rule to Action&#39;"
          href="701.rss"/>
    <meta property="og:site_name" content="StackStorm Support (ARCHIVED)"/>
    <meta property="og:type" content="website"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:url" content="https://forum.stackstorm.com/t/send-data-from-rule-to-action/701"/>
    <meta name="twitter:url" content="https://forum.stackstorm.com/t/send-data-from-rule-to-action/701"/>
    <meta property="og:title" content="Send data from Rule to Action"/>
    <meta name="twitter:title" content="Send data from Rule to Action"/>
    <meta property="og:description"
          content="Hi, I‚Äôm learning stacktorm. I‚Äôm having trouble passing data from Sensor -  Trigger -Rule to Action.  I have a sensor that checks for new rows in a MYSQL table.  The problem appears when I put the parameters in the Rule (commented in the example below ‚ÄúMy Rule‚Äù). Action execution does not occur.  If I comment the parameters, the rule successfully matches and the action executes successfully.  What will be the mistake?  The second question, how pass payload data from Rule to Action? Can you give a..."/>
    <meta name="twitter:description"
          content="Hi, I‚Äôm learning stacktorm. I‚Äôm having trouble passing data from Sensor -  Trigger -Rule to Action.  I have a sensor that checks for new rows in a MYSQL table.  The problem appears when I put the parameters in the Rule (commented in the example below ‚ÄúMy Rule‚Äù). Action execution does not occur.  If I comment the parameters, the rule successfully matches and the action executes successfully.  What will be the mistake?  The second question, how pass payload data from Rule to Action? Can you give a..."/>
    <meta name="twitter:label1" value="Reading time"/>
    <meta name="twitter:data1" value="1 mins üïë"/>
    <meta name="twitter:label2" value="Likes"/>
    <meta name="twitter:data2" value="1 ‚ù§"/>
    <meta property="article:published_time" content="2019-06-22T11:42:12+00:00"/>
    <meta property="og:ignore_canonical" content="true"/>


    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "QAPage",
        "name": "Send data from Rule to Action",
        "mainEntity": {
            "@type": "Question",
            "name": "Send data from Rule to Action",
            "text": "Hi, I‚Äôm learning stacktorm. I‚Äôm having trouble passing data from Sensor -  Trigger -Rule to Action.\n\nI have a sensor that checks for new rows in a MYSQL table.\n\nThe problem appears when I put the parameters in the Rule (commented in the example below ‚ÄúMy Rule‚Äù). Action execution does not occur.\n\nIf &hellip;",
            "upvoteCount": 0,
            "answerCount": 1,
            "dateCreated": "2019-06-22T11:42:12.193Z",
            "author": {
                "@type": "Person",
                "name": "Helder Silv√©rio"
            },
            "acceptedAnswer": {
                "@type": "Answer",
                "text": "Your rule looks good and follows <a href="
                https://forum.stackstorm.com/t/send-data-from-rule-to-action/\&quot;https://docs.stackstorm.com/rules.html#variable-interpolation\"" class=\"inline-onebox\" rel=\"nofollow noopener\">Rules ‚Äî StackStorm 3.0.1 documentation<\/a>\n\nJust to be sure, check for yaml indentation issues around parameters, as parameters and key are not indented properly (at least in commented version).\n\naction:\n\nref: monitor.action_a\n\nparameters:\n\nkey: &quot;{{trigger.k&hellip;","upvoteCount":0,"dateCreated":"2019-06-23T12:16:20.961Z","url":"https://forum.stackstorm.com/t/send-data-from-rule-to-action/701/2","author":{"@type":"Person","name":"armab"}}}}</script>

    <meta id="data-discourse-setup" data-cdn="https://sjc6.discourse-cdn.com/standard10"
          data-base-url="https://forum.stackstorm.com" data-base-uri="" data-environment="production"
          data-letter-avatar-version="5_8fec8e114563efeaf5265573e510f08e"
          data-markdown-it-url="https://aws1.discourse-cdn.com/standard10/assets/markdown-it-bundle-31e9a9c535ca1801c26da78b0ff465821751a98f921c5cdc5457d7e5a69e9748.js"
          data-service-worker-url="service-worker.js" data-default-locale="en"
          data-asset-version="597e36448c9b51d0fa3b7e43ec1fd6d5" data-disable-custom-css="false"
          data-highlight-js-path="/highlight-js/forum.stackstorm.com/ac0f4aa001e1343346941766d72e0c1ae330832b.js"
          data-svg-sprite-path="/svg-sprite/forum.stackstorm.com/svg-2-c2ad434b1e06079c7e282124aed9938dc95b83ea.js"
          data-enable-js-error-reporting="true" data-color-scheme-is-dark="false" data-user-dark-scheme-id="-1"
          data-s3-cdn="https://aws1.discourse-cdn.com/standard10"
          data-s3-base-url="//discourse-cloud-file-uploads.s3.dualstack.us-west-2.amazonaws.com/standard10">

    <meta name="discourse/config/environment"
          content="%7B%22modulePrefix%22%3A%22discourse%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%22%2C%22locationType%22%3A%22auto%22%2C%22historySupportMiddleware%22%3Afalse%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_APPLICATION_TEMPLATE_WRAPPER%22%3Afalse%2C%22_DEFAULT_ASYNC_OBSERVERS%22%3Atrue%2C%22_JQUERY_INTEGRATION%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22discourse%22%2C%22version%22%3A%222.8.0.beta6%20a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787%22%2C%22exportApplicationGlobal%22%3Atrue%7D%7D"/>
</head>

<body class="">


<header class="d-header">
    <div class="wrap">
        <div class="contents clearfix">
            <div class="title">
                <a href="../../index.html">
                    <picture>
                        <img src="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png"
                             alt="StackStorm Support (ARCHIVED)" id="site-logo"/>
                    </picture>
                </a>
            </div>

        </div>
    </div>
</header>

<div id="main-outlet" class="wrap" role="main">
    <!-- preload-content: -->

    <!-- EOF START -->
    <div class="container" id="main-container">
        <div id="ember11" class="ember-view"></div>
        <div id="ember12" class="controls ember-view"><!----></div>
        <div id="ember13" class="ember-view"><!----></div>
        <div id="ember14" class="ember-view">
            <div class="row">
                <div id="global-notice-alert-read-only" class="alert alert-info alert-read-only">
                    <!----> <span class="text">This site is in read only mode. Please continue to browse, but replying, likes, and other actions are disabled for now.</span>

                    <!---->    </div>
            </div>
            <div class="row">
                <div id="global-notice-alert-global-notice" class="alert alert-info alert-global-notice">
                    <!----> <span class="text"><h3>‚ö†Ô∏è We've moved!</h3>  <p> Hi there!<br><br> To reduce project dependency on 3rd party paid services the StackStorm TSC has decided to move the Q/A from this forum to <a
                        href="https://github.com/StackStorm/st2/discussions">Github Discussions</a>. This will make user experience better integrated with the native Github flow, as well as the questions closer to the community where they can provide answers. </p>  <p> Use üîó <b><a
                        href="https://github.com/StackStorm/st2/discussions" class="active">Github Discussions</a></b> to ask your questions. </p></span>

                    <!---->    </div>
            </div>
        </div>
        <div id="ember17" class="hidden create-topics-notice ember-view"><!----></div>
        <!---->
    </div>
    <!-- EOF END -->
    <div id="topic-title">
        <h1>
            <a href="701.html">Send data from Rule to Action</a>
        </h1>

        <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/core-st2-platform-issues/6" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Platform</span>
              </span>
            </a>
            <meta itemprop="position" content="1"/>
          </span>
            <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/core-st2-platform-issues/rule-related-issues/13" class="badge-wrapper bullet"
               itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Rules</span>
              </span>
            </a>
            <meta itemprop="position" content="2"/>
          </span>
        </div>

        <div class="topic-category">
            <div class='discourse-tags list-tags'>
                <a href='../../tag/actions' class='discourse-tag' rel="tag">actions</a>
            </div>
        </div>
    </div>


    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/hsilverio'><span itemprop='name'>hsilverio</span></a>
            (Helder Silv√©rio)
          </span>

            <link itemprop="mainEntityOfPage" href="701.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-06-22T11:42:12Z' class='post-time'>
                June 22, 2019, 11:42am
              </time>
              <meta itemprop='dateModified' content='2019-06-22T11:42:12Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Hi, I‚Äôm learning stacktorm. I‚Äôm having trouble passing data from Sensor - Trigger -Rule to Action.</p>
            <p>I have a sensor that checks for new rows in a MYSQL table.</p>
            <p>The problem appears when I put the parameters in the Rule (commented in the example below ‚ÄúMy Rule‚Äù).
                Action execution does not occur.<br>
                If I comment the parameters, the rule successfully matches and the action executes successfully.</p>
            <p>What will be the mistake?</p>
            <p>The second question, how pass payload data from Rule to Action? Can you give an example explained?</p>
            <p><strong>My Sensor:</strong></p>
            <pre><code>			#hardcoded for debug
			payload = {'key':"test", 'count': int(count) + 1} 

			self.sensor_service.dispatch(trigger='monitor.sensor', payload=payload)
</code></pre>
            <p>The payload matches the Rule criteria (checked in enforcement):</p>
            <p><strong>My Rule:</strong></p>
            <pre><code>---
name: rule_a
pack: monitor
description: Rule Dummy Data.
enabled: true
trigger:
    type: monitor.sensor
    parameters: {}
criteria:
    trigger.key:
        pattern: "test"
        type: "equals"       
action:
    ref: monitor.action_a
  #parameters:
  #key: "{{trigger.key}}"
</code></pre>
            <p>Payload in the trigger:<br>
                <code>{ "count": 47, "key": "test" }</code></p>
            <p><strong>My Action def YAML</strong></p>
            <pre><code>version: 1.0

description: Dummy action


tasks:
    main_from_database:
        action: monitor.action_def
        next:
          - when: &lt;% succeeded() %&gt;
            publish: &gt; 
                     method=&lt;% result().result.method %&gt; 
                     .....(more data)
            do:
              - api
          - when: &lt;% failed() %&gt;
            publish: stderr=&lt;% result().stderr %&gt;
            do: notify_on_error</code></pre>
        </div>

        <meta itemprop='headline' content='Send data from Rule to Action'>
        <meta itemprop='keywords' content='actions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/armab'><span itemprop='name'>armab</span></a>
            (Eugen Cusmaunsa)
          </span>

            <link itemprop="mainEntityOfPage" href="701.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-06-23T12:16:20Z' class='post-time'>
                June 23, 2019, 12:16pm
              </time>
              <meta itemprop='dateModified' content='2019-06-23T12:24:02Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Your rule looks good and follows <a href="https://docs.stackstorm.com/rules.html#variable-interpolation"
                                                   class="inline-onebox" rel="nofollow noopener">Rules ‚Äî StackStorm
                3.0.1 documentation</a></p>
            <p>Just to be sure, check for <code>yaml</code> indentation issues around <code>parameters</code>, as <code>parameters</code>
                and <code>key</code> are not indented properly (at least in commented version).</p>
            <pre><code class="lang-yaml">action:
    ref: monitor.action_a
    parameters:
        key: "{{trigger.key}}"
</code></pre>
            <p>If that still doesn‚Äôt work, try to debug it a bit and pass <code>{{trigger}}</code> or <code>{{ trigger |
                to_json }}</code> to action and verify if data/structure received is indeed correct and expected
                comparing to what you send.</p>
            <p>Additionally, your example is missing action metadata (<a
                    href="https://docs.stackstorm.com/actions.html#action-metadata" class="inline-onebox"
                    rel="nofollow noopener">Actions ‚Äî StackStorm 3.0.1 documentation</a>), - please add that as well. If
                there is some issue with action metadata, for debugging reasons - try to pass payload to existing action
                like <code>core.local</code> with <code>echo</code> like this: <a
                        href="https://github.com/StackStorm/st2/blob/master/contrib/examples/rules/sample_rule_with_actiontrigger.yaml"
                        class="inline-onebox" rel="nofollow noopener">st2/sample_rule_with_actiontrigger.yaml at master
                    ¬∑ StackStorm/st2 ¬∑ GitHub</a></p>
            <p>Don‚Äôt forget to check the st2 logs for any other error symptoms.<br>
                Hope this will help to understand where is the issue.</p>
        </div>

        <meta itemprop='headline' content='Send data from Rule to Action'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/hsilverio'><span itemprop='name'>hsilverio</span></a>
            (Helder Silv√©rio)
          </span>

            <link itemprop="mainEntityOfPage" href="701.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-06-23T19:20:15Z' class='post-time'>
                June 23, 2019,  7:20pm
              </time>
              <meta itemprop='dateModified' content='2019-06-23T19:20:15Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Hi,</p>
            <p>Thanks for the time and help.</p>
            <p>Its solved.</p>
            <p>After some tests and changes, I think there was more than one problem, at least one problem was in the
                workflow definition. Your response and then reading the logs helped to indicate the direction to go.</p>
            <p>Thank you very much,</p>
            <p><strong>Log reading:</strong></p>
            <p>Help me to realize that execution was occurring with success.</p>
            <pre><code>root@xxxx:/var/log/st2# grep -nr 5d0fb7168e02f472f99bf960 .
....
./st2rulesengine.log:158396:2019-06-23 18:29:58,581 140539742909136 INFO engine [-] Matched 1 rule(s) for trigger_instance 5d0fb7168e02f472f99bf960 (trigger=monitor.sensor)
./st2rulesengine.log:158397:2019-06-23 18:29:58,590 140539742909136 INFO enforcer [-] Invoking action monitor.action_a for trigger_instance 5d0fb7168e02f472f99bf960 with params {"key": "teste"}.</code></pre>
        </div>

        <meta itemprop='headline' content='Send data from Rule to Action'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="1"/>
            <span class='post-likes'>1 Like</span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>


    <!-- :preload-content -->
    <footer class="noscript-footer-nav">
        <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
            <a href='../../index.html'>Home</a>
            <a href="../../categories.html">Categories</a>
            <a href="https://forum.stackstorm.com/guidelines">FAQ/Guidelines</a>
            <a href="../../tos.html">Terms of Service</a>
            <a href="../../privacy.html">Privacy Policy</a>
        </nav>
    </footer>
</div>

<footer id='noscript-footer'>
    <p>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>


<section id='main'>
</section>


</body>
</html>
