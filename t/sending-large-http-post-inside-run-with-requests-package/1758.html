<!DOCTYPE html>
<html lang="en" class="desktop-view not-mobile-device text-size-normal anon">
<head>
    <meta charset="utf-8">
    <title>Sending large HTTP POST inside run() with requests package - Platform - StackStorm Support (ARCHIVED)</title>
    <meta name="description"
          content="Question about sending http post with large body via run() and using requests versus core.http. We noted that it fails using the run method with http requests and it works with the core.http. By failure i mean it runs an&amp;hellip;">
    <meta name="discourse_theme_id" content="2">
    <meta name="discourse_current_homepage" content="latest">
    <meta name="generator"
          content="Discourse 2.8.0.beta6 - https://github.com/discourse/discourse version a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787">
    <link rel="icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_32x32.PNG">
    <link rel="apple-touch-icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_180x180.PNG">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <link rel="canonical" href="1758.html"/>
    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "https://forum.stackstorm.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://forum.stackstorm.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml"
          title="StackStorm Support (ARCHIVED) Search">


    <link href="/../../stylesheets/color_definitions_base__2_3c5eec1ecf192052ea70b4afdab57a62bccc0604.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" class="light-scheme"/>

    <link href="/../../stylesheets/desktop_b2f2968742d41481357e0df259b51ce29f72481a.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" data-target="desktop"/>


    <meta name="fragment" content="!">


    <link id="manifest-link" rel="manifest" href="../../manifest.webmanifest" crossorigin="use-credentials">


    <link rel="alternate" type="application/rss+xml"
          title="RSS feed of &#39;Sending large HTTP POST inside run() with requests package&#39;" href="1758.rss"/>
    <meta property="og:site_name" content="StackStorm Support (ARCHIVED)"/>
    <meta property="og:type" content="website"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:url"
          content="https://forum.stackstorm.com/t/sending-large-http-post-inside-run-with-requests-package/1758"/>
    <meta name="twitter:url"
          content="https://forum.stackstorm.com/t/sending-large-http-post-inside-run-with-requests-package/1758"/>
    <meta property="og:title" content="Sending large HTTP POST inside run() with requests package"/>
    <meta name="twitter:title" content="Sending large HTTP POST inside run() with requests package"/>
    <meta property="og:description"
          content="Question about sending http post with large body via run() and using requests versus core.http. We noted that it fails using the run method with http requests and it works with the core.http. By failure i mean it runs and we see defunct processes eventually. We jacked the action timeout way up‚Ä¶but it never returns from run. Can someone explain why these 2 methods behave differently and when one should use the core.http versus run with requests. When i say large the body is about 2K lines of JSON..."/>
    <meta name="twitter:description"
          content="Question about sending http post with large body via run() and using requests versus core.http. We noted that it fails using the run method with http requests and it works with the core.http. By failure i mean it runs and we see defunct processes eventually. We jacked the action timeout way up‚Ä¶but it never returns from run. Can someone explain why these 2 methods behave differently and when one should use the core.http versus run with requests. When i say large the body is about 2K lines of JSON..."/>
    <meta property="article:published_time" content="2021-07-01T16:55:02+00:00"/>
    <meta property="og:ignore_canonical" content="true"/>


    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "QAPage",
        "name": "Sending large HTTP POST inside run() with requests package",
        "mainEntity": {
            "@type": "Question",
            "name": "Sending large HTTP POST inside run() with requests package",
            "text": "Question about sending http post with large body via run() and using requests versus core.http. We noted that it fails using the run method with http requests and it works with the core.http. By failure i mean it runs and we see defunct processes eventually. We jacked the action timeout way up‚Ä¶but i&hellip;",
            "upvoteCount": 0,
            "answerCount": 0,
            "dateCreated": "2021-07-01T16:55:01.918Z",
            "author": {
                "@type": "Person",
                "name": "Techdiverdown"
            }
        }
    }
    </script>

    <meta id="data-discourse-setup" data-cdn="https://sjc6.discourse-cdn.com/standard10"
          data-base-url="https://forum.stackstorm.com" data-base-uri="" data-environment="production"
          data-letter-avatar-version="5_8fec8e114563efeaf5265573e510f08e"
          data-markdown-it-url="https://aws1.discourse-cdn.com/standard10/assets/markdown-it-bundle-31e9a9c535ca1801c26da78b0ff465821751a98f921c5cdc5457d7e5a69e9748.js"
          data-service-worker-url="service-worker.js" data-default-locale="en"
          data-asset-version="597e36448c9b51d0fa3b7e43ec1fd6d5" data-disable-custom-css="false"
          data-highlight-js-path="/highlight-js/forum.stackstorm.com/ac0f4aa001e1343346941766d72e0c1ae330832b.js"
          data-svg-sprite-path="/svg-sprite/forum.stackstorm.com/svg-2-c2ad434b1e06079c7e282124aed9938dc95b83ea.js"
          data-enable-js-error-reporting="true" data-color-scheme-is-dark="false" data-user-dark-scheme-id="-1"
          data-s3-cdn="https://aws1.discourse-cdn.com/standard10"
          data-s3-base-url="//discourse-cloud-file-uploads.s3.dualstack.us-west-2.amazonaws.com/standard10">

    <meta name="discourse/config/environment"
          content="%7B%22modulePrefix%22%3A%22discourse%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%22%2C%22locationType%22%3A%22auto%22%2C%22historySupportMiddleware%22%3Afalse%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_APPLICATION_TEMPLATE_WRAPPER%22%3Afalse%2C%22_DEFAULT_ASYNC_OBSERVERS%22%3Atrue%2C%22_JQUERY_INTEGRATION%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22discourse%22%2C%22version%22%3A%222.8.0.beta6%20a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787%22%2C%22exportApplicationGlobal%22%3Atrue%7D%7D"/>
</head>

<body class="">


<header class="d-header">
    <div class="wrap">
        <div class="contents clearfix">
            <div class="title">
                <a href="../../index.html">
                    <picture>
                        <img src="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png"
                             alt="StackStorm Support (ARCHIVED)" id="site-logo"/>
                    </picture>
                </a>
            </div>

        </div>
    </div>
</header>

<div id="main-outlet" class="wrap" role="main">
    <!-- preload-content: -->

    <!-- EOF START -->
    <div class="container" id="main-container">
        <div id="ember11" class="ember-view"></div>
        <div id="ember12" class="controls ember-view"><!----></div>
        <div id="ember13" class="ember-view"><!----></div>
        <div id="ember14" class="ember-view">
            <div class="row">
                <div id="global-notice-alert-read-only" class="alert alert-info alert-read-only">
                    <!----> <span class="text">This site is in read only mode. Please continue to browse, but replying, likes, and other actions are disabled for now.</span>

                    <!---->    </div>
            </div>
            <div class="row">
                <div id="global-notice-alert-global-notice" class="alert alert-info alert-global-notice">
                    <!----> <span class="text"><h3>‚ö†Ô∏è We've moved!</h3>  <p> Hi there!<br><br> To reduce project dependency on 3rd party paid services the StackStorm TSC has decided to move the Q/A from this forum to <a
                        href="https://github.com/StackStorm/st2/discussions">Github Discussions</a>. This will make user experience better integrated with the native Github flow, as well as the questions closer to the community where they can provide answers. </p>  <p> Use üîó <b><a
                        href="https://github.com/StackStorm/st2/discussions" class="active">Github Discussions</a></b> to ask your questions. </p></span>

                    <!---->    </div>
            </div>
        </div>
        <div id="ember17" class="hidden create-topics-notice ember-view"><!----></div>
        <!---->
    </div>
    <!-- EOF END -->
    <div id="topic-title">
        <h1>
            <a href="1758.html">Sending large HTTP POST inside run() with requests package</a>
        </h1>

        <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/core-st2-platform-issues/6" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Platform</span>
              </span>
            </a>
            <meta itemprop="position" content="1"/>
          </span>
        </div>

        <div class="topic-category">
            <div class='discourse-tags list-tags'>
                <a href='../../tag/actions' class='discourse-tag' rel="tag">actions</a>,
                <a href='../../tag/python' class='discourse-tag' rel="tag">python</a>
            </div>
        </div>
    </div>


    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/techdiverdown'><span
                    itemprop='name'>techdiverdown</span></a>
            (Techdiverdown)
          </span>

            <link itemprop="mainEntityOfPage" href="1758.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-01T16:55:02Z' class='post-time'>
                July 1, 2021,  4:55pm
              </time>
              <meta itemprop='dateModified' content='2021-07-01T16:55:02Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Question about sending http post with large body via run() and using requests versus core.http. We noted
                that it fails using the run method with http requests and it works with the core.http. By failure i mean
                it runs and we see defunct processes eventually. We jacked the action timeout way up‚Ä¶but it never
                returns from run. Can someone explain why these 2 methods behave differently and when one should use the
                core.http versus run with requests. When i say large the body is about 2K lines of JSON.</p>
        </div>

        <meta itemprop='headline' content='Sending large HTTP POST inside run() with requests package'>
        <meta itemprop='keywords' content='actions, python'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/devdude'><span itemprop='name'>devdude</span></a>
            (Michael)
          </span>

            <link itemprop="mainEntityOfPage" href="1758.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-09T16:26:13Z' class='post-time'>
                July 9, 2021,  4:26pm
              </time>
              <meta itemprop='dateModified' content='2021-07-09T16:26:13Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>ST2 3.5 fix???</p>
            <aside class="onebox githubpullrequest" data-onebox-src="https://github.com/StackStorm/st2/pull/5220">
                <header class="source">

                    <a href="https://github.com/StackStorm/st2/pull/5220" target="_blank" rel="noopener nofollow ugc">github.com/StackStorm/st2</a>
                </header>

                <article class="onebox-body">
                    <div class="github-row">
                        <div class="github-icon-container" title="Pull Request">
                            <svg width="60" height="60" class="github-icon" viewbox="0 0 12 16" aria-hidden="true">
                                <path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path>
                            </svg>
                        </div>

                        <div class="github-info-container">
                            <h4>
                                <a href="https://github.com/StackStorm/st2/pull/5220" target="_blank"
                                   rel="noopener nofollow ugc">Fix subprocess handling when killed on timeout</a>
                            </h4>

                            <div class="branches">
                                <code>StackStorm:master</code> ‚Üê <code>r0m4n-z:fix_zombie_spawning_green_shell</code>
                            </div>

                            <div class="github-info">
                                <div class="date">
                                    opened <span class="discourse-local-date" data-format="ll" data-date="2021-04-03"
                                                 data-time="23:20:07" data-timezone="UTC">11:20PM - 03 Apr 21 UTC</span>
                                </div>

                                <div class="user">
                                    <a href="https://github.com/r0m4n-z" target="_blank" rel="noopener nofollow ugc">
                                        <img alt="r0m4n-z"
                                             src="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/8cd512e9145d7e6847abc7b019f2592c58dce799.jpeg"
                                             class="onebox-avatar-inline" width="20" height="20">
                                        r0m4n-z
                                    </a>
                                </div>

                                <div class="lines"
                                     title="22 commits changed 12 files with 392 additions and 10 deletions">
                                    <a href="https://github.com/StackStorm/st2/pull/5220/files" target="_blank"
                                       rel="noopener nofollow ugc">
                                        <span class="added">+392</span>
                                        <span class="removed">-10</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="github-row">
                        <p class="github-body-container">**Problem:**
                            Running ST2 actions as subprocesses (`eventlet.green`) spawns zomb<span
                                    class="show-more-container"><a href="https://github.com/StackStorm/st2/pull/5220"
                                                                   target="_blank" rel="noopener nofollow ugc"
                                                                   class="show-more">‚Ä¶</a></span><span
                                    class="excerpt hidden">ies on timeout.

**Reproduce:**
1. Spawn process which execution is going to take more than command's timeout.
2. `process.kill()` will be called.
3. Spawned process becomes zombie.

Method `process.kill()` is never handled as well as `process.communicate()`, which calls `process.wait()` - all those methods check `process.returncode` against None and if `returncode` already set, it just will be returned.

Why do I suggest to remove line 170: it doesn't seem to be necessary to set returncode here to avoid race condition for some `kill_func`. Probably additional custom attribute could be used here on `process` to provide that information if it's really necessary, but I don't think ST2 should do that.</span>
                        </p>
                    </div>

                </article>

                <div class="onebox-metadata">


                </div>

                <div style="clear: both"></div>
            </aside>

        </div>

        <meta itemprop='headline' content='Sending large HTTP POST inside run() with requests package'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>


    <!-- :preload-content -->
    <footer class="noscript-footer-nav">
        <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
            <a href='../../index.html'>Home</a>
            <a href="../../categories.html">Categories</a>
            <a href="https://forum.stackstorm.com/guidelines">FAQ/Guidelines</a>
            <a href="../../tos.html">Terms of Service</a>
            <a href="../../privacy.html">Privacy Policy</a>
        </nav>
    </footer>
</div>

<footer id='noscript-footer'>
    <p>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>


<section id='main'>
</section>


</body>
</html>
