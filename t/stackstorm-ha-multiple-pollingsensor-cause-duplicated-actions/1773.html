<!DOCTYPE html>
<html lang="en" class="desktop-view not-mobile-device text-size-normal anon">
<head>
    <meta charset="utf-8">
    <title>Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions - Rules - StackStorm Support
        (ARCHIVED)</title>
    <meta name="description" content="Hello, 
Did anyone try to deploy Stackstorm HA on Virtual Linux directly? I try to search in this forum, but it look like few people have the same problem as me. 
Anyway, I have Stackstorm HA deploy on 3 Oracle Linux 8. &amp;hellip;">
    <meta name="discourse_theme_id" content="2">
    <meta name="discourse_current_homepage" content="latest">
    <meta name="generator"
          content="Discourse 2.8.0.beta6 - https://github.com/discourse/discourse version a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787">
    <link rel="icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_32x32.PNG">
    <link rel="apple-touch-icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_180x180.PNG">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <link rel="canonical" href="1773.html"/>
    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "https://forum.stackstorm.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://forum.stackstorm.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml"
          title="StackStorm Support (ARCHIVED) Search">


    <link href="/../../stylesheets/color_definitions_base__2_3c5eec1ecf192052ea70b4afdab57a62bccc0604.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" class="light-scheme"/>

    <link href="/../../stylesheets/desktop_b2f2968742d41481357e0df259b51ce29f72481a.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" data-target="desktop"/>


    <meta name="fragment" content="!">


    <link id="manifest-link" rel="manifest" href="../../manifest.webmanifest" crossorigin="use-credentials">


    <link rel="alternate" type="application/rss+xml"
          title="RSS feed of &#39;Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions&#39;" href="1773.rss"/>
    <meta property="og:site_name" content="StackStorm Support (ARCHIVED)"/>
    <meta property="og:type" content="website"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:url"
          content="https://forum.stackstorm.com/t/stackstorm-ha-multiple-pollingsensor-cause-duplicated-actions/1773"/>
    <meta name="twitter:url"
          content="https://forum.stackstorm.com/t/stackstorm-ha-multiple-pollingsensor-cause-duplicated-actions/1773"/>
    <meta property="og:title" content="Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions"/>
    <meta name="twitter:title" content="Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions"/>
    <meta property="og:description"
          content="Hello,  Did anyone try to deploy Stackstorm HA on Virtual Linux directly? I try to search in this forum, but it look like few people have the same problem as me.  Anyway, I have Stackstorm HA deploy on 3 Oracle Linux 8. But I‚Äôm facing many Duplicated Actions issue:   First, I‚Äôm facing duplicated st2timersengine.  According to High Availability Deployment ‚Äî StackStorm 3.5.0 documentation,  [timer] enable = False  I set 2 false and 1 true on 3 vms, but it don‚Äôt work for me, very strange.  Anyway I..."/>
    <meta name="twitter:description"
          content="Hello,  Did anyone try to deploy Stackstorm HA on Virtual Linux directly? I try to search in this forum, but it look like few people have the same problem as me.  Anyway, I have Stackstorm HA deploy on 3 Oracle Linux 8. But I‚Äôm facing many Duplicated Actions issue:   First, I‚Äôm facing duplicated st2timersengine.  According to High Availability Deployment ‚Äî StackStorm 3.5.0 documentation,  [timer] enable = False  I set 2 false and 1 true on 3 vms, but it don‚Äôt work for me, very strange.  Anyway I..."/>
    <meta name="twitter:label1" value="Reading time"/>
    <meta name="twitter:data1" value="1 mins üïë"/>
    <meta name="twitter:label2" value="Likes"/>
    <meta name="twitter:data2" value="1 ‚ù§"/>
    <meta property="article:published_time" content="2021-07-12T10:56:01+00:00"/>
    <meta property="og:ignore_canonical" content="true"/>


    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "QAPage",
        "name": "Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions",
        "mainEntity": {
            "@type": "Question",
            "name": "Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions",
            "text": "Hello,\n\nDid anyone try to deploy Stackstorm HA on Virtual Linux directly? I try to search in this forum, but it look like few people have the same problem as me.\n\nAnyway, I have Stackstorm HA deploy on 3 Oracle Linux 8. But I‚Äôm facing many Duplicated Actions issue:\n\nFirst, I‚Äôm facing duplicated st2&hellip;",
            "upvoteCount": 0,
            "answerCount": 1,
            "dateCreated": "2021-07-12T10:56:01.221Z",
            "author": {
                "@type": "Person",
                "name": "Bryan Chen"
            },
            "acceptedAnswer": {
                "@type": "Answer",
                "text": "I think I find answer here:\n\n<a href="
                https://forum.stackstorm.com/t/stackstorm-ha-multiple-pollingsensor-cause-duplicated-actions/\&quot;https://docs.stackstorm.com/reference/ha.html#st2sensorcontainer\"" class=\"onebox\" target=\"_blank\" rel=\"noopener nofollow ugc\">https://docs.stackstorm.com/reference/ha.html#st2sensorcontainer<\/a>\n\nI need more investigation, and update result here","upvoteCount":1,"dateCreated":"2021-07-12T11:01:13.526Z","url":"https://forum.stackstorm.com/t/stackstorm-ha-multiple-pollingsensor-cause-duplicated-actions/1773/2","author":{"@type":"Person","name":"Bryan"}}}}
    </script>

    <meta id="data-discourse-setup" data-cdn="https://sjc6.discourse-cdn.com/standard10"
          data-base-url="https://forum.stackstorm.com" data-base-uri="" data-environment="production"
          data-letter-avatar-version="5_8fec8e114563efeaf5265573e510f08e"
          data-markdown-it-url="https://aws1.discourse-cdn.com/standard10/assets/markdown-it-bundle-31e9a9c535ca1801c26da78b0ff465821751a98f921c5cdc5457d7e5a69e9748.js"
          data-service-worker-url="service-worker.js" data-default-locale="en"
          data-asset-version="597e36448c9b51d0fa3b7e43ec1fd6d5" data-disable-custom-css="false"
          data-highlight-js-path="/highlight-js/forum.stackstorm.com/ac0f4aa001e1343346941766d72e0c1ae330832b.js"
          data-svg-sprite-path="/svg-sprite/forum.stackstorm.com/svg-2-c2ad434b1e06079c7e282124aed9938dc95b83ea.js"
          data-enable-js-error-reporting="true" data-color-scheme-is-dark="false" data-user-dark-scheme-id="-1"
          data-s3-cdn="https://aws1.discourse-cdn.com/standard10"
          data-s3-base-url="//discourse-cloud-file-uploads.s3.dualstack.us-west-2.amazonaws.com/standard10">

    <meta name="discourse/config/environment"
          content="%7B%22modulePrefix%22%3A%22discourse%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%22%2C%22locationType%22%3A%22auto%22%2C%22historySupportMiddleware%22%3Afalse%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_APPLICATION_TEMPLATE_WRAPPER%22%3Afalse%2C%22_DEFAULT_ASYNC_OBSERVERS%22%3Atrue%2C%22_JQUERY_INTEGRATION%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22discourse%22%2C%22version%22%3A%222.8.0.beta6%20a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787%22%2C%22exportApplicationGlobal%22%3Atrue%7D%7D"/>
</head>

<body class="">


<header class="d-header">
    <div class="wrap">
        <div class="contents clearfix">
            <div class="title">
                <a href="../../index.html">
                    <picture>
                        <img src="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png"
                             alt="StackStorm Support (ARCHIVED)" id="site-logo"/>
                    </picture>
                </a>
            </div>

        </div>
    </div>
</header>

<div id="main-outlet" class="wrap" role="main">
    <!-- preload-content: -->

    <!-- EOF START -->
    <div class="container" id="main-container">
        <div id="ember11" class="ember-view"></div>
        <div id="ember12" class="controls ember-view"><!----></div>
        <div id="ember13" class="ember-view"><!----></div>
        <div id="ember14" class="ember-view">
            <div class="row">
                <div id="global-notice-alert-read-only" class="alert alert-info alert-read-only">
                    <!----> <span class="text">This site is in read only mode. Please continue to browse, but replying, likes, and other actions are disabled for now.</span>

                    <!---->    </div>
            </div>
            <div class="row">
                <div id="global-notice-alert-global-notice" class="alert alert-info alert-global-notice">
                    <!----> <span class="text"><h3>‚ö†Ô∏è We've moved!</h3>  <p> Hi there!<br><br> To reduce project dependency on 3rd party paid services the StackStorm TSC has decided to move the Q/A from this forum to <a
                        href="https://github.com/StackStorm/st2/discussions">Github Discussions</a>. This will make user experience better integrated with the native Github flow, as well as the questions closer to the community where they can provide answers. </p>  <p> Use üîó <b><a
                        href="https://github.com/StackStorm/st2/discussions" class="active">Github Discussions</a></b> to ask your questions. </p></span>

                    <!---->    </div>
            </div>
        </div>
        <div id="ember17" class="hidden create-topics-notice ember-view"><!----></div>
        <!---->
    </div>
    <!-- EOF END -->
    <div id="topic-title">
        <h1>
            <a href="1773.html">Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions</a>
        </h1>

        <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/core-st2-platform-issues/6" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Platform</span>
              </span>
            </a>
            <meta itemprop="position" content="1"/>
          </span>
            <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/core-st2-platform-issues/rule-related-issues/13" class="badge-wrapper bullet"
               itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Rules</span>
              </span>
            </a>
            <meta itemprop="position" content="2"/>
          </span>
        </div>

        <div class="topic-category">
            <div class='discourse-tags list-tags'>
                <a href='../../tag/ha' class='discourse-tag' rel="tag">ha</a>
            </div>
        </div>
    </div>


    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/Bryan'><span itemprop='name'>Bryan</span></a>
            (Bryan Chen)
          </span>

            <link itemprop="mainEntityOfPage" href="1773.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-12T10:56:01Z' class='post-time'>
                July 12, 2021, 10:56am
              </time>
              <meta itemprop='dateModified' content='2021-07-12T10:56:01Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Hello,<br>
                Did anyone try to deploy Stackstorm HA on Virtual Linux directly? I try to search in this forum, but it
                look like few people have the same problem as me.<br>
                Anyway, I have Stackstorm HA deploy on 3 Oracle Linux 8. But I‚Äôm facing many Duplicated
                <code>Actions</code> issue:</p>
            <ul>
                <li>First, I‚Äôm facing duplicated st2timersengine.</li>
            </ul>
            <p>According to <a href="https://docs.stackstorm.com/reference/ha.html" class="inline-onebox"
                               rel="noopener nofollow ugc">High Availability Deployment ‚Äî StackStorm 3.5.0
                documentation</a>,</p>
            <pre><code class="lang-auto">[timer]
enable = False
</code></pre>
            <p>I set 2 false and 1 true on 3 vms, but it don‚Äôt work for me, very strange.<br>
                Anyway I solve this issue by using keeplived, As mentioned as <code>external monitoring</code></p>
            <ul>
                <li>Now, I find that multiple PollingSensor also cause duplicated actions</li>
            </ul>
            <p>There are 3 same rule/sensor of cause(each Stackstorm has one st2rulesengine/st2sensorcontainer), because
                they load the same pack.</p>
            <p>Obviously, 3 sensor polling the same system, get 3 same result and generate 3 same payloads, and then
                trigger 3 same actions.</p>
            <p>But I can‚Äôt kill 2 of them like st2timersengine, becasue external webhook send requset to upper Nginx,
                and nginx transfer the request to one of 3 stackstorm. They will cause webhook out of work.</p>
            <p>What should I do?<br>
                Otherwise, I have to use timer action instead of PollingSensor.</p>
        </div>

        <meta itemprop='headline' content='Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions'>
        <meta itemprop='keywords' content='ha'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/Bryan'><span itemprop='name'>Bryan</span></a>
            (Bryan Chen)
          </span>

            <link itemprop="mainEntityOfPage" href="1773.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-12T11:01:13Z' class='post-time'>
                July 12, 2021, 11:01am
              </time>
              <meta itemprop='dateModified' content='2021-07-12T11:01:13Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>I think I find answer here:<br>
                <a href="https://docs.stackstorm.com/reference/ha.html#st2sensorcontainer" class="onebox"
                   target="_blank" rel="noopener nofollow ugc">https://docs.stackstorm.com/reference/ha.html#st2sensorcontainer</a><br>
                I need more investigation, and update result here</p>
        </div>

        <meta itemprop='headline' content='Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="1"/>
            <span class='post-likes'>1 Like</span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/Bryan'><span itemprop='name'>Bryan</span></a>
            (Bryan Chen)
          </span>

            <link itemprop="mainEntityOfPage" href="1773.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-12T12:30:33Z' class='post-time'>
                July 12, 2021, 12:30pm
              </time>
              <meta itemprop='dateModified' content='2021-07-12T12:30:33Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Config st2.conf as following:<br>
                <a href="https://docs.stackstorm.com/reference/sensor_partitioning.html" class="onebox" target="_blank"
                   rel="noopener nofollow ugc">https://docs.stackstorm.com/reference/sensor_partitioning.html</a><br>
                I‚Äôm using the fourth method <code>[Hash]</code>, divide <code>4294967296</code> evenly into three<br>
                If I use <code>[Key-Value]</code>, then:</p>
            <ol>
                <li>Should I store all sensors in databse, divide them into three parts? I‚Äôm afraid there is no <code>all
                    the rest</code> logic.
                </li>
                <li>So if I develop a new sensor, I have to
                    <ul>
                        <li>run packs.load</li>
                        <li>reset key by st2 key set</li>
                        <li>restart st2sensorcontainer by st2ctl restart-component st2sensorcontainer</li>
                    </ul>
                </li>
            </ol>
        </div>

        <meta itemprop='headline' content='Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/minsis'><span itemprop='name'>minsis</span></a>
            (Dennis Whitney)
          </span>

            <link itemprop="mainEntityOfPage" href="1773.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-16T22:58:59Z' class='post-time'>
                July 16, 2021, 10:58pm
              </time>
              <meta itemprop='dateModified' content='2021-07-16T22:58:59Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>I don‚Äôt use the config to disable it. Under the hood st2ctl just runs systemd services. So I keep
                st2sensorcontainer and st2timersengine disabled and stopped on all the other nodes.</p>
            <p>I also customized the st2ctl script to understand which nodes are set as primary and secondary. That way
                when you run something like st2ctl start it will only start those two services on the marked primary
                node.</p>
            <p>Eventually I will have triggers to automate the failover.</p>
        </div>

        <meta itemprop='headline' content='Stackstorm HA: Multiple PollingSensor Cause Duplicated Actions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>


    <!-- :preload-content -->
    <footer class="noscript-footer-nav">
        <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
            <a href='../../index.html'>Home</a>
            <a href="../../categories.html">Categories</a>
            <a href="https://forum.stackstorm.com/guidelines">FAQ/Guidelines</a>
            <a href="../../tos.html">Terms of Service</a>
            <a href="../../privacy.html">Privacy Policy</a>
        </nav>
    </footer>
</div>

<footer id='noscript-footer'>
    <p>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>


<section id='main'>
</section>


</body>
</html>
