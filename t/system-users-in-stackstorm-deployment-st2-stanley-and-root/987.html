<!DOCTYPE html>
<html lang="en" class="desktop-view not-mobile-device text-size-normal anon">
<head>
    <meta charset="utf-8">
    <title>System users in StackStorm deployment: st2, stanley and root - Operations - StackStorm Support
        (ARCHIVED)</title>
    <meta name="description" content="We are using the docker setup of stackstorm, but we‚Äôre a bit confused by the users used to run different components in stackstorm. We identified 3 users: root, stanley and st2. 
A quick scan of the users used by the init&amp;hellip;">
    <meta name="discourse_theme_id" content="2">
    <meta name="discourse_current_homepage" content="latest">
    <meta name="generator"
          content="Discourse 2.8.0.beta6 - https://github.com/discourse/discourse version a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787">
    <link rel="icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_32x32.PNG">
    <link rel="apple-touch-icon" type="image/png"
          href="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/optimized/1X/379ced12f8326d58f1b3d2b3ff652f883e141f6a_2_180x180.PNG">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <link rel="canonical" href="987.html"/>
    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "https://forum.stackstorm.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://forum.stackstorm.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml"
          title="StackStorm Support (ARCHIVED) Search">


    <link href="/../../stylesheets/color_definitions_base__2_3c5eec1ecf192052ea70b4afdab57a62bccc0604.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" class="light-scheme"/>

    <link href="/../../stylesheets/desktop_b2f2968742d41481357e0df259b51ce29f72481a.css?__ws=forum.stackstorm.com"
          media="all" rel="stylesheet" data-target="desktop"/>


    <meta name="fragment" content="!">


    <link id="manifest-link" rel="manifest" href="../../manifest.webmanifest" crossorigin="use-credentials">


    <link rel="alternate" type="application/rss+xml"
          title="RSS feed of &#39;System users in StackStorm deployment: st2, stanley and root&#39;"
          href="https://forum.stackstorm.com/t/system-users-in-stackstorm-deployment-st2-stanley-and-root/987.rss"/>
    <meta property="og:site_name" content="StackStorm Support (ARCHIVED)"/>
    <meta property="og:type" content="website"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:image"
          content="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/891f00fbdb31fecb5bd9dab30c186d2fed0091ca.jpeg"/>
    <meta property="og:url"
          content="https://forum.stackstorm.com/t/system-users-in-stackstorm-deployment-st2-stanley-and-root/987"/>
    <meta name="twitter:url"
          content="https://forum.stackstorm.com/t/system-users-in-stackstorm-deployment-st2-stanley-and-root/987"/>
    <meta property="og:title" content="System users in StackStorm deployment: st2, stanley and root"/>
    <meta name="twitter:title" content="System users in StackStorm deployment: st2, stanley and root"/>
    <meta property="og:description"
          content="We are using the docker setup of stackstorm, but we‚Äôre a bit confused by the users used to run different components in stackstorm. We identified 3 users: root, stanley and st2.  A quick scan of the users used by the init scripts gave us this list:  /etc/init/st2actionrunner-worker.conf:setuid root /etc/init/st2api.conf:setuid st2 /etc/init/st2auth.conf:setuid st2 /etc/init/st2chatops.conf:setuid st2 /etc/init/st2garbagecollector.conf:setuid st2 /etc/init/st2notifier.conf:setuid st2 /etc/init/st2..."/>
    <meta name="twitter:description"
          content="We are using the docker setup of stackstorm, but we‚Äôre a bit confused by the users used to run different components in stackstorm. We identified 3 users: root, stanley and st2.  A quick scan of the users used by the init scripts gave us this list:  /etc/init/st2actionrunner-worker.conf:setuid root /etc/init/st2api.conf:setuid st2 /etc/init/st2auth.conf:setuid st2 /etc/init/st2chatops.conf:setuid st2 /etc/init/st2garbagecollector.conf:setuid st2 /etc/init/st2notifier.conf:setuid st2 /etc/init/st2..."/>
    <meta property="article:published_time" content="2020-01-09T14:46:57+00:00"/>
    <meta property="og:ignore_canonical" content="true"/>


    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "QAPage",
        "name": "System users in StackStorm deployment: st2, stanley and root",
        "mainEntity": {
            "@type": "Question",
            "name": "System users in StackStorm deployment: st2, stanley and root",
            "text": "We are using the docker setup of stackstorm, but we‚Äôre a bit confused by the users used to run different components in stackstorm. We identified 3 users: root, stanley and st2.\n\nA quick scan of the users used by the init scripts gave us this list:\n\n/etc/init/st2actionrunner-worker.conf:setuid root\n\n/&hellip;",
            "upvoteCount": 0,
            "answerCount": 0,
            "dateCreated": "2020-01-09T14:46:57.440Z",
            "author": {
                "@type": "Person",
                "name": ""
            }
        }
    }
    </script>

    <meta id="data-discourse-setup" data-cdn="https://sjc6.discourse-cdn.com/standard10"
          data-base-url="https://forum.stackstorm.com" data-base-uri="" data-environment="production"
          data-letter-avatar-version="5_8fec8e114563efeaf5265573e510f08e"
          data-markdown-it-url="https://aws1.discourse-cdn.com/standard10/assets/markdown-it-bundle-31e9a9c535ca1801c26da78b0ff465821751a98f921c5cdc5457d7e5a69e9748.js"
          data-service-worker-url="service-worker.js" data-default-locale="en"
          data-asset-version="597e36448c9b51d0fa3b7e43ec1fd6d5" data-disable-custom-css="false"
          data-highlight-js-path="/highlight-js/forum.stackstorm.com/ac0f4aa001e1343346941766d72e0c1ae330832b.js"
          data-svg-sprite-path="/svg-sprite/forum.stackstorm.com/svg-2-c2ad434b1e06079c7e282124aed9938dc95b83ea.js"
          data-enable-js-error-reporting="true" data-color-scheme-is-dark="false" data-user-dark-scheme-id="-1"
          data-s3-cdn="https://aws1.discourse-cdn.com/standard10"
          data-s3-base-url="//discourse-cloud-file-uploads.s3.dualstack.us-west-2.amazonaws.com/standard10">

    <meta name="discourse/config/environment"
          content="%7B%22modulePrefix%22%3A%22discourse%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%22%2C%22locationType%22%3A%22auto%22%2C%22historySupportMiddleware%22%3Afalse%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_APPLICATION_TEMPLATE_WRAPPER%22%3Afalse%2C%22_DEFAULT_ASYNC_OBSERVERS%22%3Atrue%2C%22_JQUERY_INTEGRATION%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22discourse%22%2C%22version%22%3A%222.8.0.beta6%20a1daf9fe53a66e2d2cdf9757ab4812fb9a2b2787%22%2C%22exportApplicationGlobal%22%3Atrue%7D%7D"/>
</head>

<body class="">


<header class="d-header">
    <div class="wrap">
        <div class="contents clearfix">
            <div class="title">
                <a href="../../index.html">
                    <picture>
                        <img src="https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png"
                             alt="StackStorm Support (ARCHIVED)" id="site-logo"/>
                    </picture>
                </a>
            </div>

        </div>
    </div>
</header>

<div id="main-outlet" class="wrap" role="main">
    <!-- preload-content: -->

    <!-- EOF START -->
    <div class="container" id="main-container">
        <div id="ember11" class="ember-view"></div>
        <div id="ember12" class="controls ember-view"><!----></div>
        <div id="ember13" class="ember-view"><!----></div>
        <div id="ember14" class="ember-view">
            <div class="row">
                <div id="global-notice-alert-read-only" class="alert alert-info alert-read-only">
                    <!----> <span class="text">This site is in read only mode. Please continue to browse, but replying, likes, and other actions are disabled for now.</span>

                    <!---->    </div>
            </div>
            <div class="row">
                <div id="global-notice-alert-global-notice" class="alert alert-info alert-global-notice">
                    <!----> <span class="text"><h3>‚ö†Ô∏è We've moved!</h3>  <p> Hi there!<br><br> To reduce project dependency on 3rd party paid services the StackStorm TSC has decided to move the Q/A from this forum to <a
                        href="https://github.com/StackStorm/st2/discussions">Github Discussions</a>. This will make user experience better integrated with the native Github flow, as well as the questions closer to the community where they can provide answers. </p>  <p> Use üîó <b><a
                        href="https://github.com/StackStorm/st2/discussions" class="active">Github Discussions</a></b> to ask your questions. </p></span>

                    <!---->    </div>
            </div>
        </div>
        <div id="ember17" class="hidden create-topics-notice ember-view"><!----></div>
        <!---->
    </div>
    <!-- EOF END -->
    <div id="topic-title">
        <h1>
            <a href="987.html">System users in StackStorm deployment: st2, stanley and root</a>
        </h1>

        <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/operations-related-issues/20" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #283890'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Operations</span>
              </span>
            </a>
            <meta itemprop="position" content="1"/>
          </span>
        </div>

        <div class="topic-category">
            <div class='discourse-tags list-tags'>
                <a href='../../tag/install' class='discourse-tag' rel="tag">install</a>,
                <a href='../../tag/docker' class='discourse-tag' rel="tag">docker</a>,
                <a href='../../tag/deployments' class='discourse-tag' rel="tag">deployments</a>
            </div>
        </div>
    </div>


    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/chris'><span itemprop='name'>chris</span></a>
            
          </span>

            <link itemprop="mainEntityOfPage" href="987.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-01-09T14:46:57Z' class='post-time'>
                January 9, 2020,  2:46pm
              </time>
              <meta itemprop='dateModified' content='2020-02-05T01:36:27Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>We are using the docker setup of stackstorm, but we‚Äôre a bit confused by the users used to run different
                components in stackstorm. We identified 3 users: root, stanley and st2.</p>
            <p>A quick scan of the users used by the init scripts gave us this list:</p>
            <pre><code class="lang-auto">/etc/init/st2actionrunner-worker.conf:setuid root
/etc/init/st2api.conf:setuid st2
/etc/init/st2auth.conf:setuid st2
/etc/init/st2chatops.conf:setuid st2
/etc/init/st2garbagecollector.conf:setuid st2
/etc/init/st2notifier.conf:setuid st2
/etc/init/st2resultstracker.conf:setuid st2
/etc/init/st2rulesengine.conf:setuid st2
/etc/init/st2scheduler.conf:setuid st2
/etc/init/st2sensorcontainer.conf:setuid st2
/etc/init/st2stream.conf:setuid st2
/etc/init/st2timersengine.conf:setuid st2
/etc/init/st2workflowengine.conf:setuid st2
</code></pre>
            <p>You can clearly see that all services are ran by <strong>st2</strong>, except for <code>st2actionrunner-worker</code>,
                which is ran by <strong>root</strong> and nothing by <strong>stanley</strong>. During development of our
                own packs, we were sometimes confused by this setup. There seem to be some inconsistency between
                different packs. We observed that most packs are run as root, while checking <code>$(id)</code> with
                <code>core.echo</code> produces <code>1000</code> (aka stanley).</p>
            <p>These inconsistencies confuse us and hinder our development.</p>
            <ul>
                <li>Can someone from the developer team explain the rational behind these accounts?</li>
                <li>In which situations can we expect our code to run as either root, stanley or st2?</li>
                <li>Is it strictly necessary to run all workers as root? Except for local administrative commands, we do
                    not see the need to run packs as root by default.
                </li>
            </ul>
        </div>

        <meta itemprop='headline' content='System users in StackStorm deployment: st2, stanley and root'>
        <meta itemprop='keywords' content='install, docker, deployments'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/chris'><span itemprop='name'>chris</span></a>
            
          </span>

            <link itemprop="mainEntityOfPage" href="987.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-01-30T08:55:21Z' class='post-time'>
                January 30, 2020,  8:55am
              </time>
              <meta itemprop='dateModified' content='2020-01-30T08:55:21Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>Bump! Can anyone of the dev team give an explanation of this behavior? This is one of the main reasons
                we‚Äôre reconsidering whether we want to fully adopt stackstorm or not. Authenticating a stackstorm
                workflow to run certain tasks on another service (e.g. through kerberos) is not straight forward if the
                task that does authentication is not run as the same user as the task that perform the actions on the
                remote service.<br>
                Building a stackstorm setup from scratch might give us more control over what is run by whom, but there
                should be an architectural decision behind this setup and we would really like to know why things work
                this way in a vanilla setup.</p>
        </div>

        <meta itemprop='headline' content='System users in StackStorm deployment: st2, stanley and root'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>
    <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
            <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
                <meta itemprop='name' content='StackStorm'>
                <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                    <meta itemprop='url'
                          content='https://aws1.discourse-cdn.com/standard10/uploads/stackstorm/original/1X/843840296d4160717941c20e214d0772ce899ab0.png'>
                </div>
            </div>
            <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://github.com/armab'><span itemprop='name'>armab</span></a>
            (Eugen Cusmaunsa)
          </span>

            <link itemprop="mainEntityOfPage" href="987.html">


            <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-05T01:34:24Z' class='post-time'>
                February 5, 2020,  1:34am
              </time>
              <meta itemprop='dateModified' content='2020-02-05T01:46:02Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
            <p>System users in Docker deployment are configured in the same way as default/normal installer, powered
                initially by the deb/rpm packages (<a href="https://github.com/StackStorm/st2-packages"
                                                      class="inline-onebox">GitHub - StackStorm/st2-packages: StackStorm
                    deb/rpm packages (automated docker build pipeline)</a>).</p>
            <p>st2 is just a user for running/starting the stackstorm services in the system. Some services need root,
                while stanley is a system user expected to exec action executions themselves or ssh remote actions, see
                <a href="https://docs.stackstorm.com/troubleshooting/ssh.html" class="inline-onebox">SSH Troubleshooting
                    ‚Äî StackStorm 3.1.0 documentation</a> for more details.<br>
                Privilege escalation is happening on core + sudo executions.</p>
            <p>I could find an issue with clarifies many details and reasons behind the different users. Please take a
                look at full discussion here and pointers from that thread: <a
                        href="https://github.com/StackStorm/st2/issues/3298" class="inline-onebox">Pack Install Doesn't
                    Honor System user ¬∑ Issue #3298 ¬∑ StackStorm/st2 ¬∑ GitHub</a></p>
            <p>TLDR there are some real reasons, while some are historical and definitely could be improved in the
                platform. You can try to run the st2actionrunner with no root in a custom environment. Something might
                need more detailed configuration and some functionality will be limited, but its all doable and we know
                that some orgs are doing similar custom deployments and hardened configurations.</p>
        </div>

        <meta itemprop='headline' content='System users in StackStorm deployment: st2, stanley and root'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
            <span class='post-likes'></span>
        </div>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0"/>
        </div>

    </div>


    <!-- :preload-content -->
    <footer class="noscript-footer-nav">
        <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
            <a href='../../index.html'>Home</a>
            <a href="../../categories.html">Categories</a>
            <a href="https://forum.stackstorm.com/guidelines">FAQ/Guidelines</a>
            <a href="../../tos.html">Terms of Service</a>
            <a href="../../privacy.html">Privacy Policy</a>
        </nav>
    </footer>
</div>

<footer id='noscript-footer'>
    <p>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>


<section id='main'>
</section>


</body>
</html>
